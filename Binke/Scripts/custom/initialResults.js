
jQuery.easing['jswing']=jQuery.easing['swing'];jQuery.extend(jQuery.easing,{def:'easeOutQuad',swing:function(x,t,b,c,d){return jQuery.easing[jQuery.easing.def](x,t,b,c,d);},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOutExpo:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;},easeInBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},easeOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;},easeInBounce:function(x,t,b,c,d){return c-jQuery.easing.easeOutBounce(x,d-t,0,c,d)+b;},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2)return jQuery.easing.easeInBounce(x,t*2,0,c,d)*.5+b;return jQuery.easing.easeOutBounce(x,t*2-d,0,c,d)*.5+c*.5+b;}});var timeUtils=(function(pub){pub.injectStringData=function(str,name,value){return str.replace(new RegExp('#{'+name+'}','g'),value);};var enforceLength=function(str,length,fromBack){str=str.toString();if(typeof length=='undefined')return str;if(str.length==length)return str;fromBack=(typeof fromBack=='undefined')?false:fromBack;if(str.length<length){while(length-str.length>0)str='0'+str;}else if(str.length>length){if(fromBack){str=str.substring(str.length-length);}else{str=str.substring(0,length);}}
return str;};var daysOfWeek=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];var monthsOfYear=['January','February','March','April','May','June','July','August','September','October','November','December'];var acceptedDateTokens=[{key:'d',method:function(d){return enforceLength(d.getDate(),2);}},{key:'D',method:function(d){return enforceLength(daysOfWeek[d.getDay()],3);}},{key:'j',method:function(d){return d.getDate();}},{key:'l',method:function(d){return daysOfWeek[d.getDay()];}},{key:'F',method:function(d){return monthsOfYear[d.getMonth()];}},{key:'m',method:function(d){return enforceLength(d.getMonth()+1,2);}},{key:'M',method:function(d){return enforceLength(monthsOfYear[d.getMonth()],3);}},{key:'n',method:function(d){return d.getMonth()+1;}},{key:'Y',method:function(d){return d.getFullYear();}},{key:'y',method:function(d){return enforceLength(d.getFullYear(),2,true);}}];var acceptedTimeTokens=[{key:'a',method:function(d){return(d.getHours()>11)?'pm':'am';}},{key:'A',method:function(d){return(d.getHours()>11)?'PM':'AM';}},{key:'g',method:function(d){return d.getHours()%12||12;}},{key:'G',method:function(d){return d.getHours();}},{key:'h',method:function(d){return enforceLength(d.getHours()%12||12,2);}},{key:'H',method:function(d){return enforceLength(d.getHours(),2);}},{key:'i',method:function(d){return enforceLength(d.getMinutes(),2);}},{key:'s',method:function(d){return enforceLength(d.getSeconds(),2);}}];pub.formatDate=function(d,template){template=(typeof template=='undefined')?'#{m}/#{d}/#{Y}':template;for(var i=0;i<acceptedDateTokens.length;++i){if(template.indexOf('#{'+acceptedDateTokens[i].key+'}')>-1){template=pub.injectStringData(template,acceptedDateTokens[i].key,acceptedDateTokens[i].method(new Date(d)));}}
for(var i=0;i<acceptedTimeTokens.length;++i){if(template.indexOf('#{'+acceptedTimeTokens[i].key+'}')>-1){template=pub.injectStringData(template,acceptedTimeTokens[i].key,acceptedTimeTokens[i].method(new Date(d)));}}
return template;};pub.enforceLength=function(str,length,fromBack){return enforceLength(str,length,fromBack);};return pub;})((typeof exports==='undefined')?{}:exports);var getID=function(){var id=window.location.href.split('?').shift().split('#').shift();id=(id.lastIndexOf('/')==id.length-1)?id.substring(0,id.length-1):id;return id.split('/').pop().replace(/[^0-9]/g,'');};services=(function(w,d,$,pub){w.srOID=w.srOID||getID();var state=store.get('ib.'+srOID);var apiDir='/api';var init=function(){w.srOID=jsonCtrl().model.srOid;w.accessKey=jsonCtrl().model.accessKey;w.taskXmName=jsonCtrl().model.taskXmName;w.timeoutMinutes=jsonCtrl().model.timeoutMinutes;};var saveState=function(){store.set('ib.'+srOID,state);};if(state){}else{state={ibMatches:false,costData:false,activities:{},overlay:null,bookingButton:false,hideResultsRelevancy:false,imDoneSelected:false,timeoutHandler:{initiated:new Date().getTime()},confirmation:{serviceBooked:false,appointments:[],showBookAdditional:true,initialLoad:true}};}
var registerApptOnNextTick=function(appt){w.setTimeout(function(){util.registerAppointmentEvent(appt);},0);};var responseRateSettings={adjectives:[{min:0,max:33,adjective:'Poor',description:'This pro arrives to very few scheduled appointments.'},{min:34,max:66,adjective:'Fair',description:'This pro arrives to some scheduled appointments.'},{min:67,max:89,adjective:'Good',description:'This pro arrives to most scheduled appointments.'},{min:90,max:100,adjective:'Excellent',description:'This pro arrives on time to scheduled appointments.'}]};var mapIbMatchesResponse=function(matches){for(var i=0;i<matches.length;i++){if(matches[i].spProfileReliabilityScore)matches[i].responseRate=matches[i].spProfileReliabilityScore;}};pub.getResponseRateType=function(score){for(var i=0;i<responseRateSettings.adjectives.length;++i){if(score>=responseRateSettings.adjectives[i].min&&score<=responseRateSettings.adjectives[i].max){return responseRateSettings.adjectives[i];}}
return responseRateSettings.adjectives[responseRateSettings.adjectives.length-1];};var processResponseRates=function(matches,serviceRequest){var responseRateSum=0;for(var i=0;i<matches.length;++i){matches[i].responseRate=Math.round(matches[i].responseRate*100);responseRateSum+=matches[i].responseRate;var responseRateType=pub.getResponseRateType(matches[i].responseRate);matches[i].responseRateAdjective=responseRateType.adjective;matches[i].responseRateDescription=responseRateType.description;}
var avgResponseRate=responseRateSum/matches.length;var brackets=[{min:0,max:25},{min:25,max:50},{min:50,max:75},{min:75,max:100.1}];var bracket=brackets[0];for(var i=0;i<brackets.length;++i){if(avgResponseRate>=brackets[i].min&&avgResponseRate<brackets[i].max){bracket=brackets[i];break;}}
s_sm.addEvarValue('eVar97',bracket.min+'% - '+Math.floor(bracket.max)+'%');};var mutateCredentials=function(matches){for(var i=0;i<matches.length;i++){for(var j=0;j<matches[i].spInfo.credentials.length;j++){matches[i].spInfo.credentials[j].descriptions=matches[i].spInfo.credentials[j].descriptions.map(function(desc){return{description:desc};})}}
return matches;}
var processMatches=function(matches,serviceRequest){var taskOID=serviceRequest.taskOId;var bookingButtonsDisabled=typeof jsonCtrl().model.bookingButtonsActive!="undefined"&&!jsonCtrl().model.bookingButtonsActive
processResponseRates(matches,serviceRequest);for(var i=0;i<matches.length;++i){matches[i].schedulable=bookingButtonsDisabled?false:matches[i].schedulable;matches[i].taskOID=taskOID;if(typeof matches[i].appointment!='undefined'){var appt={start:new Date(matches[i].appointment.startTime).toISOString(),end:new Date(matches[i].appointment.endTime).toISOString()};var apptType=(matches[i].activityTypeString=='BOOKED_SERVICE')?'service':'estimate';appt=util.createAppointmentObject(appt,matches[i].spId,matches[i].spInfo.companyName,apptType,matches[i].spInfo);registerApptOnNextTick(appt);}
if(matches[i].ibAccountInfo)matches[i].ibAccountInfo.settings.formattedWorkingHours=workingHours.processAndFormatWorkingHours(matches[i].ibAccountInfo.settings.workingHours);}
return matches;};$(d).ready(init);pub.getSite34068Result=function(cb){opts={url:'/myhomeadvisor/IB/confirmation/getSite34068Result',type:'get',name:'getSite34068Result'};pub.performRequest(opts,cb);}
pub.getMatches=function(srOID,cb,flushCache,specialOpts){specialOpts=typeof specialOpts=='undefined'?{}:specialOpts;flushCache=(typeof flushCache=='undefined')?false:flushCache;var ibMatchesUrl=apiDir+'/resource/consumer/_entityId/servicerequest/'+srOID+'/ib-matches';if(typeof jsonCtrl().model.useIbMatchesMicroservice!='undefined'&&jsonCtrl().model.useIbMatchesMicroservice){ibMatchesUrl=apiDir+'/resource/ib-matches/'+srOID;}
var cacheBust=new Date().getTime();var opts=$.extend({url:ibMatchesUrl,params:{'r_version':jsonCtrl().model.ibTest?2:1,'cbuster':cacheBust},name:'matches',type:'GET'},specialOpts);if(state.ibMatches&&!flushCache){cb(null,state.ibMatches);}else{pub.performRequest(opts,function(err,data){if(err){cb(err,null);}else if(typeof data==='undefined'||typeof data.ibMatches==='undefined'||data.ibMatches===null||data.ibMatches.length===0){errorReporter.registerError('Results API',new Error('(c710e69a) Error calling '+ibMatchesUrl+' - No displayable matched pros for SR '+srOID));util.redirectToConfirmation();}else{mapIbMatchesResponse(data.ibMatches);if(jsonCtrl().model.ibTest)data.ibMatches=mutateCredentials(data.ibMatches)
data.ibMatches=processMatches(data.ibMatches,data.serviceRequest);state.ibMatches=data;saveState();cb(null,data);}});}};pub.setEngagement=function(spID,srOID,data,cb){var dataToSend,opts;status=(typeof status=='undefined')?false:status;dataToSend={};dataToSend=_.extend(dataToSend,data);opts={url:apiDir+'/resource/booking/'+srOID+'/sp/'+spID+'/engagement',type:'POST',data:dataToSend,name:'engagement'};pub.performRequest(opts,cb);};var getAvailabilityStartAndEnd=function(){var obj={};obj.start=new Date();obj.end=new Date(obj.start);obj.end.setDate(obj.end.getDate()+(jsonCtrl().model.numDaysToShow||20));return obj;};pub.getAvailability=function(request,cb){var bounds=getAvailabilityStartAndEnd();var opts={url:apiDir+'/resource/availability/'+request.spId,params:{postalCode:request.zip,startDatetime:bounds.start.toISOString().split('.')[0]+"Z",endDatetime:bounds.end.toISOString().split('.')[0]+"Z",taskOid:request.taskOid,viewType:'consumer',r_version:2}};pub.performRequest(opts,cb);};pub.getActivity=function(request,cb){var opts={url:apiDir+'/resource/activity/',params:{spId:request.spId,taskOid:request.taskOid},method:'GET',name:'activity'};if(typeof state.activities[request.spId]=='undefined'){pub.performRequest(opts,function(err,data){if(err){cb(err,null);}else{if(data.settings.tripCharge)data.settings.tripChargeString=data.settings.tripCharge.toFixed(2);state.activities[request.spId]=data;saveState();cb(null,data);}});}else{cb(null,state.activities[request.spId]);}};pub.getPricing=function(request,cb,getCostGuide){getCostGuide=typeof getCostGuide=='undefined'?false:getCostGuide;var data={type:'blurb',data:{}};if(!getCostGuide){if(request.dynamic){pub.getPricing(request,cb,true);}else{pub.getActivity(request,function(err,resp){if(err){errorReporter.registerError('Activity API',err);pub.getPricing(request,cb,true);}else{if(resp.pricing!=null&&typeof resp.pricing=='object'&&resp.pricing.comments){data.type='activity';data.data=resp;cb(null,data);}else{pub.getPricing(request,cb,true);}}});}}else{pub.requestCostData(request,function(err,resp){if(err){errorReporter.registerError('Cost Data API',err);cb(null,data);}else{data.type='costData';data.data=resp;cb(null,data);}});}};var requestedPhoneQuotes=[];var processingPhoneQuotes=false;var performRequestPhoneQuoteRequest=function(){if(!processingPhoneQuotes){processingPhoneQuotes=true;var thisRequest=requestedPhoneQuotes.shift();var opts={url:apiDir+'/resource/serviceprovider/'+thisRequest.spID+'/lead',type:'POST',data:thisRequest.data,name:'leadphone'};pub.performRequest(opts,function(err,resp){processingPhoneQuotes=false;if(requestedPhoneQuotes.length)w.setTimeout(performRequestPhoneQuoteRequest,200);thisRequest.cb(err,resp);});}};pub.requestPhoneQuote=function(spID,srOID,integrated,cb,customData){var data;data={srOid:srOID,activityTypeId:3,isObIntegrated:integrated};data=$.extend(data,typeof customData=='undefined'?{}:customData);requestedPhoneQuotes.push({data:data,cb:cb,spID:spID});if(!processingPhoneQuotes)performRequestPhoneQuoteRequest();};pub.scheduleAppt=function(spID,srOID,data,cb,customOpts,customData){var opts={url:apiDir+'/resource/serviceprovider/'+spID+'/lead',type:'POST',data:$.extend(data,typeof customData=='undefined'?{}:customData),name:'leadappt'};$.extend(opts,typeof customOpts=='undefined'?{}:customOpts);pub.performRequest(opts,cb);};pub.analyzeMatchesForOmniture=function(matches){if(matches.length>1)s_sm.ibRequestQuotesAllShown();if(_.where(matches,{'leadTypeId':111}).length)s_sm.ibViewPricingShown();if(_.where(matches,{'leadTypeId':112}).length)s_sm.ibScheduleEstimateShown();var mmrPros=_.where(matches,{'leadTypeId':-1});if(mmrPros.length){var schedulable=_.where(mmrPros,{schedulable:true});if(schedulable.length){s_sm.ibViewPricingShown();var evt='event204',name='MMR-IB: '+schedulable.length+' Pro'+(schedulable.length>1?'s':'')+' Displayed';switch(schedulable.length){case 1:evt='event201';break;case 2:evt='event202';break;case 3:evt='event203';break;default:break;}
s_sm.fireSimpleEvent(evt,name);}}};pub.requestCostData=function(request,cb){var opts={url:'/sm/cost/widget/updateGeo',params:{zipCode:request.zip,taskOid:request.taskOid},type:'GET',name:'costguide'};if(state.costData){cb(null,state.costData);}else{pub.performRequest(opts,function(err,data){if(err){cb(err,null);}else if(data.success==false){cb(data,null);}else{state.costData=data.costGuideWidgetDataHolder;state.costData=(state.costData.localCostData)?state.costData.localCostData:state.costData.regionCostData;state.costData=(state.costData)?state.costData:data.costGuideWidgetDataHolder.nationalCostData;if(state.costData){state.costData={avg:state.costData.avgCost,avgMax:state.costData.avgRangeMaxCost,avgMin:state.costData.avgRangeMinCost};}else{state.costData=null;}
saveState();cb(null,state.costData);}});}};pub.getState=function(key){if(typeof key=='undefined'){return state;}else if(typeof state[key]=='undefined'){return false;}else{return state[key];}};pub.saveState=function(key,data){state[key]=data;saveState();};pub.updateLocalStorage=function(key,data){state[key]=data;saveState();};pub.updateLeadIdBySpId=function(spId,leadId,leadTypeId){leadTypeId=typeof leadTypeId=='undefined'?113:leadTypeId;if(typeof state['ibMatches']!='undefined'){for(var i=0;i<state.ibMatches.ibMatches.length;++i){if(state.ibMatches.ibMatches[i].spId==spId&&state.ibMatches.ibMatches[i].leadId!=leadId){var originalId=state.ibMatches.ibMatches[i].leadId;state.ibMatches.ibMatches[i].leadId=leadId;state.ibMatches.ibMatches[i].leadTypeId=leadTypeId;if(originalId==0&&leadId!=0){simpleBind.bind('matches',state.ibMatches.ibMatches);}
saveState();break;}}}};pub.listMatches=function(){if(s_env=='dev'){var matches=state.ibMatches.ibMatches;for(var i=0;i<matches.length;++i){console.log((i+1)+") "+matches[i].spInfo.companyName+" - "+matches[i].ibAccountInfo.accountType+" \n\t spid: "+matches[i].spId+" \t|\t "+matches[i].activityTypeString+" \n\n");}}};pub.getNumberEligibleForQuote=function(matches){var count=0;for(var i=0;i<matches.length;++i){if(matches[i].xmDirectoryPhoneNum!=''||matches[i].hunger>0)++count;}
return count;};pub.getNumberEligibleForBooking=function(){var count=0;for(var i=0;i<state.ibMatches.ibMatches.length;++i){if(state.ibMatches.ibMatches[i].schedulable==true)++count;}
return count;};pub.buildSelectedPros=function(page){var selectedPros={pros:state.ibMatches.ibMatches.slice(0),count:0};selectedPros.pros.sort(function(a,b){var aHasAppt=typeof a.appt!='undefined';var bHasAppt=typeof b.appt!='undefined';if(aHasAppt&&!bHasAppt)return-1;if(aHasAppt&&bHasAppt)return 0;return 1;});for(var i=0;i<selectedPros.pros.length;++i){if(typeof selectedPros.pros[i].appt!='undefined'||selectedPros.pros[i].leadId!=0)++selectedPros.count;}
if(page=='confirmationPage'&&typeof w['isMMRARTest']=='undefined'){var bookedPros=selectedPros.pros.filter(function(pro){return typeof pro.appt!='undefined';});}
simpleBind.bind('selectedPros',selectedPros);};pub.getQuestionsAndAnswers=function(request,fn){var questionSetId=2373;var opts={url:apiDir+'/resource/sr-result-relevance-survey/_entityId/questionset/'+questionSetId+'/'+request.questionId,name:'getquestionsandanswers'};pub.performRequest(opts,fn);};pub.postQuestionsAndAnswers=function(request,fn){var data={questionSetId:2373};$.extend(data,request);var opts={url:apiDir+'/resource/sr-result-relevance-survey/'+srOID+'/selectedanswers/_entityId/',data:data,type:'POST',name:'postquestionsandanswers',formEncoded:true};pub.performRequest(opts,fn);};pub.putCoherenceCache=function(request,fn){var opts={url:'/transientcache/pageproperties/property/'+request.name,params:{propKey:request.key,propValue:request.val},type:'POST',name:'putcoherencecache'};pub.performRequest(opts,fn);};pub.getSpInfo=function(req,cb){var opts={url:apiDir+'/resource/spinfodetail/'+req.spId,name:'get_sp_services',cache:true};pub.performRequest(opts,cb);};pub.getMessaging=function(spIds,cb){var opts={url:apiDir+'/resource/conversation-handler/user/eligibility/'+jsonCtrl().model.entityID,params:{spIds:spIds.join(',')}};pub.performRequest(opts,cb);};return pub;})(window,document,jQuery,services||{});!function(a,b){"use strict";if("function"!=typeof a.createEvent)return!1;var c,d,e,f,g,h,i="undefined"!=typeof jQuery,j=!!navigator.pointerEnabled||navigator.msPointerEnabled,k=!!("ontouchstart"in b)&&navigator.userAgent.indexOf("PhantomJS")<0||j,l=function(a){var b=a.toLowerCase(),c="MS"+a;return navigator.msPointerEnabled?c:b},m={touchstart:l("PointerDown")+" touchstart",touchend:l("PointerUp")+" touchend",touchmove:l("PointerMove")+" touchmove"},n=function(a,b,c){for(var d=b.split(" "),e=d.length;e--;)a.addEventListener(d[e],c,!1)},o=function(a){return a.targetTouches?a.targetTouches[0]:a},p=function(){return(new Date).getTime()},q=function(b,e,f,g){var h=a.createEvent("Event");if(g=g||{},g.x=c,g.y=d,g.distance=g.distance,i)jQuery(b).trigger(e,g);else{h.originalEvent=f;for(var j in g)h[j]=g[j];h.initEvent(e,!0,!0),b.dispatchEvent(h)}},r=function(a){var b=o(a);e=c=b.pageX,f=d=b.pageY,h=p(),z++},s=function(a){var b=[],i=f-d,j=e-c;if(clearTimeout(g),-u>=j&&b.push("swiperight"),j>=u&&b.push("swipeleft"),-u>=i&&b.push("swipedown"),i>=u&&b.push("swipeup"),b.length)for(var k=0;k<b.length;k++){var l=b[k];q(a.target,l,a,{distance:{x:Math.abs(j),y:Math.abs(i)}})}else h+v-p()>=0&&e>=c-x&&c+x>=e&&f>=d-x&&d+x>=f&&q(a.target,2===z?"dbltap":"tap",a),g=setTimeout(function(){z=0},w)},t=function(a){var b=o(a);c=b.pageX,d=b.pageY},u=b.SWIPE_THRESHOLD||100,v=b.TAP_THRESHOLD||150,w=b.DBL_TAP_THRESHOLD||200,x=b.TAP_PRECISION/2||30,y=b.JUST_ON_TOUCH_DEVICES||k,z=0;n(a,m.touchstart+(y?"":" mousedown"),r),n(a,m.touchend+(y?"":" mouseup"),s),n(a,m.touchmove+(y?"":" mousemove"),t)}(document,window);var readMore=(function(w,d,$,pub){var init,processReadMoreSections,readMoreClickHandler;var state={sections:{}};init=function(){state.sections=$('.read-more').toArray();state.sections=state.sections.concat($('[data-read-more').toArray());$('.read-more-toggle').on('click',readMoreClickHandler);processReadMoreSections(state.sections);};processReadMoreSections=function(sections){for(var i=0;i<sections.length;++i){if(sections[i].getAttribute('id')){var id,opts=$(sections[i]).data();id=sections[i].getAttribute('id');opts['expanded-height']=(typeof opts['expanded-height']=='undefined')?500:opts['expanded-height'];state.sections[id]={el:sections[i],opts:opts,expanded:false};$(sections[i]).addClass('animated');sections[i].style.overflow='hidden';sections[i].style.maxHeight=opts.height+'px';}}};readMoreClickHandler=function(){var opts,section;opts=$(this).data();section=state.sections[opts.rel];if(section.expanded){section.expanded=false;section.el.style.maxHeight=section.opts.height+'px';}else{section.expanded=true;section.el.style.maxHeight=section.opts['expanded-height']+'px';}
updateSectionLinks(section,opts.rel);};var updateSectionLinks=function(section,relID){var links=$('.read-more-toggle[data-rel="'+relID+'"]').toArray();for(var i=0;i<links.length;++i){if(section.expanded){links[i].setAttribute('data-read-more',links[i].innerHTML);links[i].innerHTML=links[i].getAttribute('data-read-less');}else{links[i].innerHTML=links[i].getAttribute('data-read-more');}}};var hideSectionLinks=function(relID){$('.read-more-toggle[data-rel="'+relID+'"]').css({display:'none'});};var collapseAll=function(){for(var key in state.sections){if(state.sections[key].expanded){$('.read-more-toggle[data-rel="'+key+'"]').first().click();}}};$(d).ready(init);pub.collapseAll=function(){collapseAll();};return pub;})(window,document,jQuery,{});var floatyBar=(function(w,d,$,pub){var init,delay,setupFloater,decide,recalculateThresholds,state={floaters:[],visibleClass:'visible',stickyClass:'floaty-sticky',isSticky:false};decide=function(){var currPos=w.pageYOffset,viewportHeight=document.documentElement.clientHeight,bottomY=currPos+viewportHeight;for(var i=0;i<state.floaters.length;++i){if(state.floaters[i].stickyEnd){var elemHeight=$(state.floaters[i].elem).outerHeight(),threshTop=state.floaters[i].stickyThreshTop,stickyTop=state.floaters[i].stickyTop,stickyTopWithElem=stickyTop+elemHeight;if(threshTop!=null){if(state.floaters[i].stickyEndFrom=="bottom"){var currTop=w.pageYOffset,currTopWithElem=currTop+elemHeight;if(threshTop<=currTopWithElem){var offset=parseInt(state.floaters[i].stickyOffset);var diff=(threshTop-stickyTopWithElem>=0?threshTop-stickyTopWithElem+offset:0);$(state.floaters[i].elem).removeClass(state.visibleClass);$(state.floaters[i].elem).addClass(state.stickyClass);state.floaters[i].isSticky=true;state.floaters[i].elem.style.position="absolute";state.floaters[i].elem.style.top=diff+"px";}else if(threshTop>currTopWithElem){$(state.floaters[i].elem).removeClass(state.stickyClass);state.floaters[i].isSticky=false;state.floaters[i].elem.style.position="";state.floaters[i].elem.style.top="";}}}}
if(currPos>=state.floaters[i].thresholdTop&&((state.floaters[i].scrollFrom!='bottom'&&currPos<state.floaters[i].thresholdBottomAlt&&currPos<state.floaters[i].thresholdBottom)||(state.floaters[i].scrollFrom=="bottom"&&bottomY<state.floaters[i].thresholdBottom))&&!state.floaters[i].isSticky){$(state.floaters[i].elem).addClass(state.visibleClass);if(state.floaters[i].offsetLeft&&state.floaters[i].offsetRight){state.floaters[i].elem.style.left=state.floaters[i].offsetLeft;state.floaters[i].elem.style.right=state.floaters[i].offsetRight;}}else if(currPos>=state.floaters[i].thresholdTop&&state.floaters[i].scrollFrom!='bottom'&&currPos<state.floaters[i].thresholdBottomAlt){$(state.floaters[i].elem).addClass(state.visibleClass);}else{$(state.floaters[i].elem).removeClass(state.visibleClass);if(state.floaters[i].elem.getAttribute('data-floaty-parent')){state.floaters[i].elem.style.left='';state.floaters[i].elem.style.right='';}}}};setupFloater=function(elem){var $parent;if(elem.getAttribute('data-floaty-parent')){$parent=$(elem.getAttribute('data-floaty-parent'));}
if(elem.getAttribute('data-floaty-anchor-position')){var offset=$(elem.getAttribute('data-floaty-anchor-position')).offset().top%1,diff=1-offset,offsetElem=$(elem.getAttribute('data-floaty-anchor-position'))[0];if(offsetElem.style.position){var currTop=(offsetElem.style.top?offsetElem.style.top:0),newTop=diff;currTop=parseInt(currTop.replace('px',''));newTop+=currTop;offsetElem.style.top=newTop+"px";}else{offsetElem.style.position="relative";offsetElem.style.top=diff+"px";}}
state.floaters.push({elem:elem,startTop:$(elem).offset().top,thresholdTop:$(elem.getAttribute('data-floaty-start')).offset().top,thresholdBottom:(elem.getAttribute('data-floaty-end')?$(elem.getAttribute('data-floaty-end')).offset().top:Infinity),thresholdBottomAlt:elem.getAttribute('data-floaty-end-bottom')?Math.max($(elem.getAttribute('data-floaty-end-bottom')).offset().top-$(window).height(),0):Infinity,offsetLeft:(elem.getAttribute('data-floaty-parent')?$(elem.getAttribute('data-floaty-parent')).offset().left:null),offsetRight:(elem.getAttribute('data-floaty-parent')?Math.floor($(window).width()-($parent.offset().left+$parent.outerWidth())):null),scrollFrom:(elem.getAttribute('data-floaty-from')?elem.getAttribute('data-floaty-from').toLowerCase():"top"),stickyEnd:(elem.getAttribute('data-floaty-sticky-end')?elem.getAttribute('data-floaty-sticky-end'):false),stickyEndFrom:(elem.getAttribute('data-floaty-sticky-from')?elem.getAttribute('data-floaty-sticky-from'):"bottom"),stickyTop:(elem.getAttribute('data-floaty-sticky-top')?$(elem.getAttribute('data-floaty-sticky-top')).offset().top:null),stickyThreshTop:(elem.getAttribute('data-floaty-sticky-thresh')?$(elem.getAttribute('data-floaty-sticky-thresh')).offset().top:null),stickyOffset:(elem.getAttribute('data-floaty-sticky-offset')?elem.getAttribute('data-floaty-sticky-offset'):0)})};recalculateThresholds=function(){$('.floaty-bar').removeClass(state.visibleClass);for(var i=0;i<state.floaters.length;++i){state.floaters[i].startTop=$(state.floaters[i].elem).offset().top;if(!$(state.floaters[i].elem.getAttribute('data-floaty-start')).toArray().length)return false;state.floaters[i].thresholdTop=$(state.floaters[i].elem.getAttribute('data-floaty-start')).offset().top;if(state.floaters[i].elem.getAttribute('data-floaty-end')){state.floaters[i].thresholdBottom=$(state.floaters[i].elem.getAttribute('data-floaty-end')).offset().top;}else{state.floaters[i].thresholdBottom=Infinity;}
if(state.floaters[i].elem.getAttribute('data-floaty-end-bottom')){state.floaters[i].thresholdBottomAlt=Math.max($(state.floaters[i].elem.getAttribute('data-floaty-end-bottom')).offset().top-$(window).height(),0);}else{state.floaters[i].thresholdBottom=Infinity;}
if(state.floaters[i].elem.getAttribute('data-floaty-parent')){var $parent=$(state.floaters[i].elem.getAttribute('data-floaty-parent'));state.floaters[i].offsetLeft=$parent.offset().left+"px";state.floaters[i].offsetRight=Math.floor($(window).width()-($parent.offset().left+$parent.outerWidth()))+"px";}
if(state.floaters[i].elem.getAttribute('data-floaty-sticky-thresh')){state.floaters[i].stickyTop=$(state.floaters[i].elem.getAttribute('data-floaty-sticky-top')).offset().top;state.floaters[i].stickyThreshTop=$(state.floaters[i].elem.getAttribute('data-floaty-sticky-thresh')).offset().top;}}
decide();};init=function(){var floaties=$('.floaty-bar').toArray();for(var i=0;i<floaties.length;++i){setupFloater(floaties[i]);}
window.addEventListener('scroll',decide);window.onresize=function(){delay(recalculateThresholds,110);};decide();};delay=(function(){var timer=0;return function(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms);};})();$(d).ready(init);pub.swapVisibleClass=function(newClass){state.visibleClass=newClass;};pub.recalculateThresholds=recalculateThresholds;pub.state=state;return pub;})(window,document,window.jQuery||window.HA.dom,{});var relevancyModule=(function(w,d,$,pub){var conf,state,priv;var bindEvents,collectState,init;pub.conf=conf={container:'ResultsRelContainer'};priv={};pub.state=state={elems:{},events:{},model:{},errors:{},autoInit:false,omniTracking:false,srOid:typeof jsonCtrl().model.srOid!='undefined'?jsonCtrl().model.srOid:0};state.sanitized={};collectState=function(){state.elems.container=d.getElementById(conf.container);state.elems.questions=d.getElementById('firstQuestionSet');state.elems.submitSecondSet=d.getElementById('submitSecondQuestionSet');state.elems.answers=d.getElementById('answersContainer');state.elems.successMessage=d.getElementById('relevancySuccess');state.elems.selectBox=d.getElementById('secondQuestionSet');state.elems.firstQuestionPage=d.getElementById('firstQuestionSetContainer');state.elems.secondQuestionPage=d.getElementById('secondQuestionSetContainer');state.elems.simulatedEvent={};state.elems.simulatedEvent.firstSubmit=d.getElementById('relevancySimulatedFirstClick');state.elems.simulatedEvent.secondSubmit=d.getElementById('relevancySimulatedSecondClick');state.elems.relevancySimulatedModulePresentation=d.getElementById('relevancySimulatedModulePresentation');};priv.handleQuestionsSet=function(){if(state.model.firstQuestionSet&&state.model.secondQuestionSet){if(state.model.firstQuestionSet.presentationType=='RADIO_BUTTON'){priv.createQuestionsList('questions',state.model.firstQuestionSet,true);}else{priv.createInputButton('questions',state.model.firstQuestionSet);}
priv.createSelectBox(state.model.secondQuestionSet);}}
priv.createQuestionsList=function(type,questions,showDesc){var cont=d.createDocumentFragment();for(var i=0;i<questions.answerList.length;++i){var current,div,label,input,span;current=questions.answerList[i];div=util.createElem({type:'div',classes:'question-row'});label=util.createElem({type:'label'});input=util.createElem({type:'input',classes:'question-radio'});span=util.createElem({type:'span',classes:'question-label'});input.setAttribute('type','radio');input.setAttribute('value',current.answerId);input.setAttribute('name','questionSet');input.setAttribute('data-answer-text',current.answerText);input.setAttribute('data-question-id',questions.questionId);input.setAttribute('data-answer-id',current.answerId);label.appendChild(input);var labelText=d.createTextNode(current.answerDisplayText);if(showDesc){if(i==0){labelText.nodeValue+=' Not Helpful';}else if((i+1)==questions.answerList.length){labelText.nodeValue+=' Very Helpful';}}
span.appendChild(labelText);label.appendChild(span);div.appendChild(label);cont.appendChild(div);}
state.elems[type].appendChild(cont);};priv.createInputButton=function(type,questions){var frag=d.createDocumentFragment();if(typeof questions!='undefined'&&questions.answerList instanceof Array){for(var i=0;i<questions.answerList.length;++i){var current,div,input;current=questions.answerList[i];div=util.createElem({type:'div',classes:'question-row question-row-button cf'});input=util.createElem({type:'button',classes:'ha-btn text-button question-button'});input.setAttribute('value',current.answerId);input.setAttribute('data-answer-text',current.answerText);input.setAttribute('data-question-id',questions.questionId);input.setAttribute('data-answer-id',current.answerId);input.appendChild(d.createTextNode(current.answerDisplayText));div.appendChild(input);frag.appendChild(div);}
state.elems[type].appendChild(frag);}};priv.createSelectBox=function(questions){var frag;if(typeof questions!='undefined'&&questions.answerList instanceof Array&&state.elems.selectBox){frag=d.createDocumentFragment();for(var i=0;i<questions.answerList.length;++i){var current=questions.answerList[i];var option=util.createElem({type:'option'});option.setAttribute('value',current.answerId);option.setAttribute('data-answer-text',current.answerText);option.setAttribute('data-question-id',questions.questionId);option.setAttribute('data-answer-id',current.answerId);option.appendChild(d.createTextNode(current.answerDisplayText));frag.appendChild(option);}
state.elems.selectBox.appendChild(frag);}};bindEvents=function(){$('#firstQuestionSetContainer button, #firstQuestionSetContainer input').on('click',state.events.firstQuestionSetClick);$(state.elems.submitSecondSet).on('click',state.events.secondQuestionSetClick);};state.events.firstQuestionSetClick=function(e){var elem=this;if(typeof this.selectedIndex!='undefined'){elem=state.elems.selectBox[this.selectedIndex];}
var val=elem.getAttribute('value');state.sanitized.initialAnswerId=(parseFloat(val)?parseFloat(val):null);if(elem.getAttribute('data-answer-text')!==null){state.sanitized.initialAnswerText=encodeURIComponent(elem.getAttribute('data-answer-text'));}else{state.sanitized.initialAnswerText=null;}
if(elem.getAttribute('data-question-id')!==null){state.sanitized.initialQuestionId=(parseFloat(elem.getAttribute('data-question-id'))?parseFloat(elem.getAttribute('data-question-id')):null);}else{state.sanitized.initialQuestionId=null;}
if(state.sanitized.initialAnswerId!==null&&state.sanitized.initialAnswerText!==null&&state.sanitized.initialQuestionId!==null){if(typeof w.confirmationController!='undefined')confirmationController.setCache('hideResultsRelevancy',true);if(typeof services.saveState!='undefined'){services.saveState('hideResultsRelevancy',true);}
if(typeof services.putCoherenceCache!='undefined'){services.putCoherenceCache({name:'proResultsConfirmation',key:'hideResultsRelevancy',val:true},function(err,resp){});}
if(typeof w.localStorage!='undefined'){w.localStorage.setItem('hideResultsRelevancyModule_'+state.srOid,'true');}
$(state.elems.simulatedEvent.firstSubmit).trigger('click');if(state.sanitized.initialAnswerText=='Yes'||state.sanitized.initialAnswerText>=3){$(state.elems.firstQuestionPage).removeClass('visible').addClass('invisible');$(state.elems.simulatedEvent.firstSubmit).trigger('rrModuleSelectedYes');priv.showSuccessfulMessageUi();}else{$(state.elems.firstQuestionPage).removeClass('visible').addClass('invisible');$(state.elems.secondQuestionPage).removeClass('invisible').addClass('visible');customLinkModule.trackModule(state.elems.relevancySimulatedModulePresentation.getAttribute('data-omniture-module'));}
priv.postAnswers(function(err){});}};state.events.secondQuestionSetClick=function(e){e.preventDefault();var elem=state.elems.selectBox;if(typeof elem.selectedIndex!='undefined'){elem=state.elems.selectBox[elem.selectedIndex];}
var val=elem.getAttribute('value');state.sanitized.subsequentAnswerId=(parseFloat(val)?parseFloat(val):null);if(elem.getAttribute('data-answer-text')!==null){state.sanitized.subsequentAnswerText=encodeURIComponent(elem.getAttribute('data-answer-text'));}else{state.sanitized.subsequentAnswerText=null;}
if(elem.getAttribute('data-question-id')!==null){state.sanitized.subsequentQuestionId=(parseFloat(elem.getAttribute('data-question-id'))?parseFloat(elem.getAttribute('data-question-id')):null);}else{state.sanitized.subsequentQuestionId=null;}
if(state.sanitized.subsequentAnswerId!==null&&state.sanitized.subsequentAnswerText!==null&&state.sanitized.subsequentQuestionId!==null){$(state.elems.simulatedEvent.secondSubmit).trigger('click');if(typeof w.confirmationController!='undefined')confirmationController.setCache('hideResultsRelevancy',true);if(typeof services.saveState!='undefined'){services.saveState('hideResultsRelevancy',true);}
if(typeof services.putCoherenceCache!='undefined'){services.putCoherenceCache({name:'proResultsConfirmation',key:'hideResultsRelevancy',val:true},function(err,resp){});}
if(typeof w.localStorage!='undefined'){w.localStorage.setItem('hideResultsRelevancyModule_'+state.srOid,'true');}
priv.postAnswers(function(){$(state.elems.secondQuestionPage).removeClass('visible').addClass('invisible');priv.showSuccessfulMessageUi();});}};priv.showSuccessfulMessageUi=function(){$(state.elems.container).addClass('success');$(state.elems.successMessage).removeClass('invisible').addClass('visible');w.setTimeout(function(){$(state.elems.container).fadeOut();},1500);};priv.getQuestions=function(fn){var checkResponses,respKeys,expected,errors=[];respKeys=[];expected=2;checkResponses=function(key,err,data){respKeys.push(key);if(err){errors.push({name:key,err:err});state.model[key]=err;}
if(data)state.model[key]=data;if(key=='secondQuestionSet'&&state.model[key].answerList){state.model[key].answerList=_.shuffle(state.model[key].answerList);}
if(respKeys.length===expected){if(!errors.length){return fn(null,state.model);}else{return fn(errors,null);}}};services.getQuestionsAndAnswers({questionId:8326},function(err,data){checkResponses('firstQuestionSet',err,data);});services.getQuestionsAndAnswers({questionId:8327},function(err,data){checkResponses('secondQuestionSet',err,data);});};priv.postAnswers=function(fn){services.postQuestionsAndAnswers(state.sanitized,function(err,data){if(err){state.errors.postQuestionsAndAnswers=err;}else{if(d.location.hash=='#feedback'){modal.close('feedback');}}
fn(err,data);});};init=function(){collectState();var cancel=false;if(typeof services.getState!='undefined'){cancel=services.getState('hideResultsRelevancy');}
if(typeof w.localStorage!='undefined'){cancel=w.localStorage.getItem('hideResultsRelevancyModule_'+state.srOid);}
if(state.elems.container&&!cancel){state.autoInit=(state.elems.container.getAttribute('data-auto-init')&&state.elems.container.getAttribute('data-auto-init')=='true');state.omniTracking=(state.elems.container.getAttribute('data-omniture-tracking')&&state.elems.container.getAttribute('data-omniture-tracking')=='true');priv.getQuestions(function(err,data){if(err){state.elems.container.setAttribute('data-module-error',true);}
if(data){$(state.elems.container).removeClass('invisible').addClass('slide-down').addClass('visible');priv.handleQuestionsSet();bindEvents();}
if(state.omniTracking){customLinkModule.trackModule(state.elems.container.getAttribute('data-omniture-module'));}});}};var initialInit=function(){var animationDelay=0;if(typeof jsonCtrl!='undefined'){animationDelay=(typeof jsonCtrl().model.relevancyAnimationDelay!='undefined'?jsonCtrl().model.relevancyAnimationDelay:0);}
w.setTimeout(init,animationDelay);};$(d).ready(initialInit);return pub;})(window,document,jQuery,{});var util=(function(w,d,$,pub){var getKeys,getAttrs,getData;getKeys=function(obj){if(Object.keys){return Object.keys(obj);}else{arr=[];for(var key in obj){arr.push(key);}
return arr;}};getAttrs=function(elem){var attrs,obj={};attrs=elem.attributes;for(var i=0;i<attrs.length;++i){var attr=attrs.item(i);obj[attr.nodeName]=(attr.hasOwnProperty('value'))?attr.value:attr.nodeValue;}
return obj;};getData=function(elem){var attrs,keys,data={};attrs=getAttrs(elem);keys=getKeys(attrs);for(var i=0;i<keys.length;++i){if(keys[i].indexOf('data-')==0){data[keys[i].substring(5,keys[i].length)]=attrs[keys[i]];}}
return data;};pub.getKeys=function(obj){return getKeys(obj);};pub.getAttrs=function(elem){return getAttrs(elem);};pub.getData=function(elem){return getData(elem);};pub.redirectToConfirmation=function(success,matchtype){success=(typeof success=='undefined')?false:true;matchtype=(typeof matchtype=='undefined')?'aaa':'bff';if(typeof window['postConfirmation']!='undefined'){var loc='/myhomeadvisor/confirmation/'+srOID+'/';loc+=(success)?'?ib=true':'?oerpb='+matchtype;window.location.href=loc;}else{return false;}};pub.getSearchObject=function(){var obj={},search=window.location.search;if(search.indexOf('?')==0)search=search.substring(1);search=search.split('&');for(var i=0;i<search.length;++i){var term=search[i].split('=');obj[term[0]]=(term.length>1)?term[1]:'';}
return obj;};pub.serializeJsonToForm=function(data){var key,result=[];for(key in data){if(data.hasOwnProperty(key)){result.push(encodeURIComponent(key)+"="+encodeURIComponent(data[key]));}}
return result.join("&");};pub.createAppointmentObject=function(obj,spID,companyName,type,spInfo){obj.label=util.formatTimeLabel(new Date(obj.start));obj.labelAlt=util.formatTimeLabel(new Date(obj.start),true);obj.type=type;obj.companyName=companyName;obj.spID=spID;obj.spId=spID;obj.srOid=srOID;if(typeof spInfo!='undefined'){obj.profileUrl='/myhomeadvisor/myprojects/'+srOID+'/profile/'+spID;if(spInfo.meteredPhoneNumber){obj.phoneNum=spInfo.exactMatchMeteredPhoneNumber||'';}else{obj.phoneNum=null;}
if(spInfo.profilePicGalleryURL){obj.photoUrl=spInfo.profilePicGalleryURL;}else if(spInfo.logoPicGalleryURL){obj.photoUrl=spInfo.logoPicGalleryURL;}else{obj.photoUrl=null;}}
return obj;};pub.registerAppointmentEvent=function(appt){if(typeof w['postConfirmation']!='undefined'){postConfirmation.registerAppointment(appt);}else if(typeof w['bookingButton']!='undefined'){bookingButton.registerAppointmentCreationAttempt(true,appt);}};pub.formatTimeLabel=function(date,alt){alt=(typeof alt=='undefined')?false:alt;if(alt){var format='#{l}, #{F} #{j}, #{Y} <span style="display:inline-block;"><span class="at">@</span>  #{g}:#{i} #{A}</span>'}else{var format='#{l}, #{M} #{j}, #{Y} <span> @ </span> #{g}:#{i} #{A}.';}
return timeUtils.formatDate(date,format);};var alreadyAutoforwarded=false;pub.logAutoForward=function(){if(!alreadyAutoforwarded){alreadyAutoforwarded=true;s_sm.fireSimpleEvent('event189','IB Autoforward');}};pub.logTimeout=function(){s_sm.fireSimpleEvent('event188','IB Timeout');};return pub;})(window,document,jQuery,util||{});var errorReporter=(function(w,d,$,pub){var state={errorsReported:{},currError:null,handlers:{},errorTypes:{'Results API':{id:0},'Availability API':{id:2},'Activity API':{id:3},'Lead API - Phone':{id:4},'Lead API - Appt':{id:5},'Cost Data':{id:6}}};var defaultOpts={postToSiteLog:true,message:false,error:false};var postToSiteLog=function(err,errID){errID=(typeof errID=='undefined')?1:errID;var pageName=s_sm.pageName||window.location.href;var data={error_data:JSON.stringify(err),error_id:errID,page_name:pageName,field_name:w.location.href};if(typeof window['srOID']!='undefined'){if(typeof window['initialResults']!='undefined'||typeof window['bookingButton']!='undefined'){data['question_id']=srOID;}}
$.ajax({url:"/api/resource/sitelog/log/?r_username=ob_cons_web_api&r_accesskey="+accessKey,type:"POST",data:data,dataType:"json"});};var defaultErrorReport=function(type,err,opts){if(typeof state.errorsReported[type]=='undefined'){state.errorsReported[type]={count:0,errors:[]};}
++state.errorsReported[type].count;err.errorCount=state.errorsReported[type].count;if(opts.postToSiteLog){postToSiteLog(err,(typeof state.errorTypes[type]=='undefined')?'1':state.errorTypes[type].id);}};pub.registerError=function(type,err,opts){opts=_.extend({},defaultOpts,(typeof opts=='undefined')?{}:opts);if(typeof err['simfail']!='undefined'){if(s_env=='dev'){console.log("Not reporting simulated error of type, '"+type+"'.");}}else{if(typeof state.handlers[type]=='undefined'){return defaultErrorReport(type,err,opts);}else{return state.handlers[type](type,err,opts);}}};pub.registerHandler=function(type,handler){if(typeof handler=='function'){state.handlers[type]=handler;}};return pub;})(window,document,jQuery,{});var formatTime=function(date,removeSpace){removeSpace=(typeof removeSpace==='undefined')?false:removeSpace;var hours,minutes,ampm,strTime;hours=date.getHours();minutes=date.getMinutes();ampm=hours>=12?'PM':'AM';hours=hours%12;hours=hours?hours:12;minutes=minutes<10?'0'+minutes:minutes;strTime=hours+':'+minutes;strTime+=(removeSpace)?'':' ';strTime+=''+ampm;return strTime;};var calendarWidget=(function(w,d,$,pub){var settings,state,jsonModel,months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],daysOfWeek=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],shortDaysOfWeek=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];jsonModel=jsonCtrl().model;settings={singleColBreakpoint:jsonModel.ibTest?10000000:550,cssAnimationDisableTimer:300,buttonHeightMultiplier:55,largestDay:10,numOfColumnsDesktop:3,shortDays:false,noYearInHeader:false};state={count:0,calendars:[],currWidth:false,cssEnablerTimer:false};var handleTimeBtnClick=function(){var calendarContainer,calIndex;calendarContainer=$(this).parents('#slidable')[0].parentNode;calIndex=calendarContainer.getAttribute('data-calindex');state.calendars[calIndex].selectedTime=$(this).data();if(typeof state.calendars[calIndex].eventHandlers['onChange']!=='undefined'){state.calendars[calIndex].eventHandlers['onChange'](state.calendars[calIndex].selectedTime);}};var defaultBuildOpts={linkHref:'#confirmation',timeClickHandler:handleTimeBtnClick,timesFilter:function(block){return typeof block.blockType==='undefined'||block.blockType==='free'},button:function(block,label,opts){if(typeof block.blockType!=='undefined'&&opts.unbookableBlockTypes.indexOf(block.blockType)>-1){return'a.btn.btn-disabled$[data-start='+block.startTime+',data-end='+block.endTime+']${'+label+'}';}else{return'a.btn.btn-primary$[data-start='+block.startTime+',data-end='+block.endTime+',data-simpleevent=click:confirmationOverlay]${'+label+'}';}},unbookableBlockTypes:['blocked','appointment','unavailable']};var init=function(){$(w).resize(function(){delay(handleResize,100);});handleResize();$('.calScroller').on('click',handleScrollClick);$('.sliding-day-container').on('swipeleft swiperight',handleSwipes);modal.onKeyPress(handleKeyPresses);};var delay=(function(){var timer=0;return function(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms);};})();var handleResize=function(force,target,attempt){var currWidth;force=(typeof force==='undefined')?false:force;attempt=typeof attempt==='undefined'?0:attempt;currWidth=Math.max(d.documentElement.clientWidth,w.innerWidth||0);if(currWidth!==state.currWidth||force){state.currWidth=currWidth;var mult=(state.currWidth>=settings.singleColBreakpoint)?.333:1;target=typeof target==='undefined'?state.calendars:target;for(var i=0;i<target.length;++i){temporarilyDisableAnimations(target[i]);target[i].el.style.width='';if(mult<1){$(target[i].calendar).css({height:'auto'});}else{adjustDayHeight(target[i],target[i].dayIndex);}
var space=Math.floor(target[i].el.offsetWidth);if(space===0){invokeResizeLater(target[i],force,attempt);continue;}
if(mult<1){var mod=space%settings.numOfColumnsDesktop;if(mod){space=space-mod;}
target[i].el.style.width=(space-1)+"px";}else{showLess(target[i]);}
var newWidth=space/(mult<1?settings.numOfColumnsDesktop:1);target[i].dayWidth=newWidth;var sliderWidth=(mult===1)?(target[i].dayWidth+1)*target[i].availability.schedules.length:target[i].dayWidth*target[i].availability.schedules.length;target[i].calendar.style.width=sliderWidth+'px';target[i].minLeft=target[i].dayWidth*target[i].availability.schedules.length*-1+newWidth;$(target[i].el).find('.day').css({width:newWidth+'px'});if(typeof target[i]['dayIndex']!=='undefined'){var newLeft=target[i].dayWidth*target[i].dayIndex;target[i].calendar.style.left=(-1*newLeft)+"px";}}}};var invokeResizeLater=function(config,force,attempt){if(attempt<12){w.setTimeout(function(){handleResize(force,[config],++attempt);},100*Math.max(1,(attempt*.25)));}};var temporarilyDisableAnimations=function(calendar,enable){enable=(typeof enable==='undefined')?false:enable;w.clearTimeout(calendar.cssAnimEnablerTimer);$(calendar.el)[(enable)?'removeClass':'addClass']('notransition');if(!enable){calendar.cssAnimEnablerTimer=w.setTimeout(function(){temporarilyDisableAnimations(calendar,true);},settings.cssAnimationDisableTimer);}};var getOrSetCalendarObject=function(el){if(!el.getAttribute('data-calindex')){el.setAttribute('data-calindex',state.count);++state.count;state.calendars.push({el:el,eventHandlers:{},nextAvailableDays:[],nextAvailableButtons:[]});}
return state.calendars[el.getAttribute('data-calindex')];};var buildCalendar=function(el,availability,opts){opts=$.extend({},defaultBuildOpts,typeof opts==='undefined'?{}:opts);var index,cal;$(el).removeClass('loaded calendarLoaded');el.innerHTML='';getOrSetCalendarObject(el);index=parseInt(el.getAttribute('data-calindex'));cal=jDom.create('div#slidable.slidable.hw-accelerated');cal.style.left='0px';settings.largestDay=0;settings.largestDayIndex=0;if(opts.hasOwnProperty('singleColBreakpoint'))settings.singleColBreakpoint=opts.singleColBreakpoint;if(opts.hasOwnProperty('header')&&opts.header instanceof Object){if(opts.header.hasOwnProperty('shortDays'))settings.shortDays=opts.header.shortDays;if(opts.header.hasOwnProperty('noYear'))settings.noYearInHeader=opts.header.noYear;}
state.calendars[index].nextAvailableDays=[];state.calendars[index].nextAvailableButtons=[];var searchingForAvailableDay=[];for(var i=0;i<availability.schedules.length;++i){var dayObj=buildDay(availability.schedules[i],index,i===0,i===availability.schedules.length-1,opts);cal.appendChild(dayObj.el);if(availability.schedules[i].blocks.length>settings.largestDay){settings.largestDay=availability.schedules[i].blocks.length;settings.largestDayIndex=i;}
if(availability.schedules[i].blocks.length===0){searchingForAvailableDay.push(true);}else if(searchingForAvailableDay.length&&availability.schedules[i].blocks.length){while(searchingForAvailableDay.length){searchingForAvailableDay.shift();state.calendars[index].nextAvailableDays.push(i);}}}
cal=el.appendChild(cal);state.calendars[index].availability=availability;state.calendars[index].calendar=cal;state.calendars[index].dayIndex=0;state.calendars[index].expanded=false;hideShowScrollButtons(state.calendars[index],'left');hideShowScrollButtons(state.calendars[index],'right',true);handleResize(true);if(state.calendars[index].nextAvailableDays.length){updateShowNextButtons(index);}else if(state.calendars[index].nextAvailableButtons.length){$(state.calendars[index].nextAvailableButtons).each(function(i,el){el.parentNode.removeChild(el);});}
$(el).addClass('loaded calendarLoaded');simpleBind.recollectDOM();if(availability.schedules.length&&!availability.schedules[0].blocks.length&&state.calendars[index].nextAvailableButtons.length&&state.calendars[index].nextAvailableDays.length){var autoScroll=true;w.setTimeout(function(){scrollCalendar(state.calendars[index],'right',state.calendars[index].nextAvailableDays[0]-state.calendars[index].dayIndex);},550);}};var randomIntegerInInterval=function(min,max){return Math.floor(Math.random()*(max-min+1)+min);};var buildDay=function(times,calIndex,isToday,isLastDay,opts){var anyAvailable=times.blocks.filter(opts.timesFilter);if(anyAvailable.length===0)times.blocks=[];var date,dayLabel,dateLabel,day,showMoreLink;date=new Date(times.date.replace(/-/g,'/'));dayLabel=settings.shortDays?shortDaysOfWeek[date.getDay()]:daysOfWeek[date.getDay()];if(settings.noYearInHeader){dateLabel=months[date.getMonth()]+' '+date.getDate();}else{dateLabel=(date.getMonth()+1)+'/'+date.getDate()+'/'+date.getFullYear();}
if(jsonModel.ibTest){var desktopLabel=timeUtils.formatDate(new Date(date),"#{l} #{F} #{j}, #{Y}");var mobileLabel=timeUtils.formatDate(new Date(date),"#{l} #{m}/#{d}/#{Y}");day=jDom.create('div.day$>div.heading$>.hidden-singlecol${'+desktopLabel+'}$+.hidden-multicol${'+mobileLabel+'}');}else{day=jDom.create('div.day$>div.heading$>strong${'+dayLabel+'}$+span${'+dateLabel+'}');}
var buttonContainer=jDom.create('div.times.animated.hw-accelerated'+(times.blocks.length?'':'.empty'));state.calendars[calIndex].buttonContainer=buttonContainer;if(times.blocks.length){var blockDate,timeLabel,btn;for(var i=0;i<times.blocks.length;++i){var newBlockDate=new Date(times.blocks[i].startTime);if(typeof blockDate!=='undefined'&&blockDate!==null&&blockDate.getTime()===newBlockDate.getTime())continue;blockDate=newBlockDate;timeLabel=formatTime(blockDate);var domStr=opts.button(times.blocks[i],timeLabel,opts);btn=jDom.create(domStr);if(opts.unbookableBlockTypes.indexOf(times.blocks[i].blockType)===-1||typeof(times.blocks[i].blockType)==='undefined'){btn.setAttribute('href',opts.linkHref);$(btn).on('click',opts.timeClickHandler);}
buttonContainer.appendChild(btn);}}else{if(!jsonModel.ibTest){var unavailableText='No Times Available';unavailableText+=(isToday)?' Today':'';buttonContainer.appendChild(jDom.create('p.text-center$>strong.no-times${'+unavailableText+'}'));}
if(!isLastDay){btn=jDom.create('button.t-button-utility.t-small.scrollNext$[data-index='+calIndex+']${Next available - }');$(btn).on('click',handleNextAvailableBtnClick);state.calendars[calIndex].nextAvailableButtons.push(buttonContainer.appendChild(btn));}}
if(jsonModel.ibTest){var timesSlider=jDom.create('div.times-slider');timesSlider.appendChild(buttonContainer)
if(times.blocks.length)buttonContainer.style.width=times.blocks.length*90+"px";day.appendChild(timesSlider);}else{day.appendChild(buttonContainer);}
if(times.blocks.length>6){showMoreLink=jDom.create('div.show-more.show-more-button$[data-calindex='+calIndex+',data-show=true]${More Times}')
$(showMoreLink).on('click',handleShowMoreClick);}else{showMoreLink=jDom.create('div.show-more.spacer$[data-calindex='+calIndex+',data-show=true]');}
day.appendChild(showMoreLink);return{el:day};};var handleShowMoreClick=function(){var show=this.getAttribute('data-show');if(state.currWidth>=settings.singleColBreakpoint||jsonModel.ibTest){var calIndex=parseInt(this.getAttribute('data-calindex'));if(show==='true'){showMore(state.calendars[calIndex]);}else{showLess(state.calendars[calIndex]);}}};var showMore=function(calendar){var initialHeight,targetHeight,timeSel=$(calendar.el).find('.times');initialHeight=timeSel[0].offsetHeight+'px';timeSel.val(settings.largestDayIndex).css({maxHeight:'none',minHeight:'none'});targetHeight=timeSel[settings.largestDayIndex].offsetHeight+'px';timeSel.val(settings.largestDayIndex).css({maxHeight:initialHeight,minHeight:initialHeight});w.setTimeout(function(){timeSel.css({maxHeight:targetHeight,minHeight:targetHeight});$(calendar.el).find('.show-more-button').text('Fewer Times').attr('data-show',false);$(calendar.el).find('.show-more').addClass('reverse');calendar.expanded=true;},0);};var showLess=function(calendar){$(calendar.el).find('.times').css({maxHeight:'',minHeight:''});$(calendar.el).find('.show-more-button').text('More Times').attr('data-show',true);$(calendar.el).find('.show-more').removeClass('reverse');calendar.expanded=false;};var handleNextAvailableBtnClick=function(){var calendar=state.calendars[this.getAttribute('data-calindex')],nextIndex=this.getAttribute('data-shownextindex');scrollCalendar(calendar,'right',calendar.nextAvailableDays[nextIndex]-calendar.dayIndex);};var handleScrollClick=function(){var opts=$(this).data();if(!$(this).hasClass('disabled')){if(typeof opts.rel!=='undefined'){var el=d.getElementById(opts.rel);if(el){if(el.getAttribute('data-calindex')){var calendar=state.calendars[parseInt(el.getAttribute('data-calindex'))];scrollCalendar(calendar,opts.dir,(state.currWidth<settings.singleColBreakpoint)?1:3);if(calendar.expanded){showLess(calendar);}}}}}};var handleSwipes=function(e){var sel='.calScroller.';sel+=(e.type==='swipeleft')?'right':'left';$(this.parentNode).find(sel).first().click();};var handleKeyPresses=function(e,hash){if(hash==='#appointment'){var swipe=false;switch(e.keyCode){case 37:swipe='left';break;case 39:swipe=swipe?swipe:'right';if(swipe!==false&&state.calendars.length){$(state.calendars[0].el.parentNode).find('.calScroller.'+swipe).first().click();}
break;case 40:if(state.calendars.length){$(state.calendars[0].el.parentNode).find('.show-more-button:not(.reverse)').first().click();}
break;default:break;}}};var adjustDayHeight=function(calendar,calIndex){if(typeof calendar.calendar!=='undefined'){$(calendar.calendar).css({height:calendar.calendar.childNodes[calIndex].offsetHeight+'px'});}};var scrollCalendar=function(calendar,direction,numToMove){var isSingleCol=(state.currWidth<settings.singleColBreakpoint);if(isSingleCol){adjustDayHeight(calendar,(direction==='right')?calendar.dayIndex+1:calendar.dayIndex-1);}
direction=(typeof direction==='undefined')?'right':direction;direction=(direction==='right')?-1:1;var currLeft=parseInt(calendar.calendar.style.left);var movementAmount=numToMove*calendar.dayWidth;var displace=direction*movementAmount;var minLeft=(-1*calendar.calendar.offsetWidth)+calendar.el.offsetWidth;minLeft=(isSingleCol)?calendar.minLeft:minLeft;var newLeft=displace+currLeft;if(newLeft<=minLeft){newLeft=minLeft;hideShowScrollButtons(calendar,'right');}else{hideShowScrollButtons(calendar,'right',true);}
if(newLeft>=0){newLeft=0;hideShowScrollButtons(calendar,'left');}else{hideShowScrollButtons(calendar,'left',true);}
calendar.dayIndex=Math.round(Math.abs(newLeft)/calendar.dayWidth);calendar.calendar.style.left=newLeft+"px";};var updateShowNextButtons=function(calIndex){var calendar=state.calendars[calIndex],buttons=calendar.nextAvailableButtons;for(var i=0;i<Math.min(buttons.length,calendar.nextAvailableDays.length);++i){var dateLabel=timeUtils.formatDate(new Date(calendar.availability.schedules[calendar.nextAvailableDays[i]].date.replace(/-/g,'/')),"#{l}, #{F} #{j}");if(jsonModel.ibTest){var mobileLabel=timeUtils.formatDate(new Date(calendar.availability.schedules[calendar.nextAvailableDays[i]].date.replace(/-/g,'/')),"#{m}/#{d}/#{Y}");buttons[i].innerHTML=buttons[i].innerHTML+"<span class='hidden-singlecol'>"+dateLabel+"</span><span class='hidden-multicol'>"+mobileLabel+"</span><span class='icon icon_arrow'></span>"}else{buttons[i].innerHTML=buttons[i].innerHTML+dateLabel;}
buttons[i].setAttribute('data-calindex',calIndex);buttons[i].setAttribute('data-shownextindex',i);}};var hideShowScrollButtons=function(calendar,direction,show){show=(typeof show==='undefined')?false:show;$('.calScroller[data-dir="'+direction+'"][data-rel="'+calendar.el.getAttribute('id')+'"]')[(show)?'removeClass':'addClass']('disabled');};pub.calendar=function(el,availability,opts){buildCalendar(el,availability,opts);};pub.onchange=function(el,handler){var calObj=getOrSetCalendarObject(el);if(typeof handler==='function'){calObj.eventHandlers['onChange']=handler;}};pub.showMore=function(el){var index=el.getAttribute('data-calindex');if(state.calendars.length>index){showMore(state.calendars[index]);}};pub.showLess=function(el){var index=el.getAttribute('data-calindex');if(state.calendars.length>index){showLess(state.calendars[index]);}};pub.resize=function(){handleResize(true);return true;};$(d).ready(init);return pub;})(window,document,jQuery,{});var bookingOverlay=(function(w,d,$,pub){var state,settings,readySubscribers=[],jsonModel;var pageNamePrefix='';if(typeof w['isMMRARTest']!='undefined'){pageNamePrefix=isMMRARTest?'MMR-':'';}
state={ready:false,auth:null,pros:{},schedules:{},activities:{},appointment:null,srInfo:null,currPro:false,initialOpen:true,callRequested:false,errorCount:0,refreshed:false};settings={maxErrors:1,successfulRedirectTimeout:1200};jsonModel=jsonCtrl().model;var init=function(){var saved=services.getState('overlay');if(saved){state=_.extend(state,saved);state.refreshed=true;state.errorCount=0;state.initialOpen=true;state.refreshed=true;}
domCollection();domBindings();};var saveState=function(){var stateToSave=_.extend({},state);delete stateToSave['dom'];delete stateToSave['schedules'];delete stateToSave['activities'];delete stateToSave['auth'];delete stateToSave['srInfo'];services.saveState('overlay',stateToSave);};var domCollection=function(){state.dom={calContainer:d.getElementById('calendarContainer'),calendarLoadError:d.getElementById('calendarLoadError'),pricingPanel:d.getElementById('pricingPanel'),costPanel:d.getElementById('costGuidePricingPanel'),apptOverlay:d.getElementById('apptOverlay'),confirmError:d.getElementById('confirmError'),confirmErrorCalendar:d.getElementById('confirmErrorCalendar'),confirmationOverlay:d.getElementById('confirmationSection'),schedulingOverlay:d.getElementById('schedulingSection'),scheduledOverlay:d.getElementById('scheduledSection'),buttons:{confirmAppt:d.getElementById('confirmAppt'),changeAppt:d.getElementById('changeAppt')}};};var domBindings=function(){$(state.dom.buttons.confirmAppt).on('click',confirmAppt);simpleBind.registerEvent('bookOnlineClickHandler',bookOnlineClickHandler);};var hideCalendarConflictError=function(){$(state.dom.confirmErrorCalendar).removeClass('visible');};var showCalendarConflictTimeout=null;var showCalendarConflictErrorTemporarily=function(delayPresence){w.clearTimeout(showCalendarConflictTimeout);if(typeof delayPresence!='undefined'){w.setTimeout(showCalendarConflictErrorTemporarily,800);return false;}
$(state.dom.confirmErrorCalendar).addClass('visible');showCalendarConflictTimeout=w.setTimeout(function(){$(state.dom.confirmErrorCalendar).removeClass('visible');},10000);};var bookOnlineClickHandler=function(){var opts={spID:this.getAttribute('sp-id'),taskID:this.getAttribute('task-id'),leadID:(this.getAttribute('lead-id'))?this.getAttribute('lead-id'):false,leadTypeID:this.getAttribute('lead-type-id'),sroid:this.getAttribute('sr-oid')};var conflictOccurred=$(this).hasClass('schedule-conflict');if(!conflictOccurred){hideCalendarConflictError();}else{showCalendarConflictErrorTemporarily(true);}
readMore.collapseAll();var addlProps={prop68:services.getResponseRateType(state.pros[opts.spID].responseRate).adjective};if(state.currPro!=opts.spID||state.refreshed){if(state.refreshed)state.refreshed=false;$(state.dom.calContainer).removeClass('calendarLoaded loaded');$(state.dom.pricingPanel).removeClass('pricingLoaded');state.currPro=opts.spID;saveState();injectOverlayData('pro',state.pros[opts.spID]);injectOverlayData('srInfo',state.srInfo);getAvailabilityAndPricing(opts,conflictOccurred,function(availability,activity){var name="Instant Booking: Initial Overlay";name+=(availability)?'':' - Availability API Error';name+=(activity)?'':' - Activity API Error';s_sm.trackOverlayPage({},{name:pageNamePrefix+name},[],addlProps);});}else{calendarWidget.resize();s_sm.trackOverlayPage({},{name:pageNamePrefix+"Instant Booking: Initial Overlay"},[],addlProps);}};var handleTimeClick=function(selectedTime){s_sm.trackOverlayPage({},{name:pageNamePrefix+"Instant Booking: Confirmation Overlay"});var apptType=(state.pros[state.currPro].activityTypeString=='BOOKED_SERVICE')?'service':'estimate';state.appointment=util.createAppointmentObject(selectedTime,state.currPro,state.pros[state.currPro].spInfo.companyName,apptType,$.extend({},state.pros[state.currPro].spInfo));saveState();injectOverlayData('chosenAppt',state.appointment);$('#confirmError').removeClass('visible');};var getAvailabilityAndPricing=function(opts,conflictOccurred,cb){var registerInfoTransfer,registered={pricing:false,availability:false},count=0;var registerInfoTransfer=function(type,success){++count;registered[type]=success;if(count==2){cb(registered.availability,registered.pricing);}};if(typeof state.schedules[opts.spID]=='undefined'){$(state.dom.calendarLoadError).removeClass('visible');services.setEngagement(opts.spID,srOID,{engagementStatusId:(state.pros[opts.spID].activityTypeString=='IN_PERSON_ESTIMATE')?3:4},function(err,resp){if(err){errorReporter.registerError('Engagement API Error - Overlay',err,{});s_sm.trackOverlayPage({},{name:pageNamePrefix+"Instant Booking: Initial Results Error - Engagement"});}});services.getAvailability({zip:state.srInfo.conZip,taskOid:state.srInfo.taskOId,spId:opts.spID},function(err,resp){if(err){errorReporter.registerError('Availability API',err);$(state.dom.calendarLoadError).addClass('visible');registerInfoTransfer('availability',false);}else{if(typeof resp.daySchedules!='undefined')resp.schedules=resp.daySchedules;state.schedules[opts.spID]=resp;calendarWidget.calendar(state.dom.calContainer,resp);if(state.initialOpen){state.initialOpen=false;calendarWidget.onchange(state.dom.calContainer,handleTimeClick);}
registerInfoTransfer('availability',true);}});}else{calendarWidget.calendar(state.dom.calContainer,state.schedules[opts.spID]);if(state.initialOpen){state.initialOpen=false;calendarWidget.onchange(state.dom.calContainer,handleTimeClick);saveState();}
registerInfoTransfer('availability',true);}
services.getPricing({spId:opts.spID,taskOid:state.srInfo.taskOId,zip:state.srInfo.conZip,dynamic:state.pros[opts.spID].ibAccountInfo?state.pros[opts.spID].ibAccountInfo.accountType=='DYNAMIC':false},function(err,resp){if(resp.type=='activity'){resp.xmTaskName=state.srInfo.taskXMName;state.activities[opts.spID]=resp;}
if(resp.type=='blurb'){state.pros[opts.spID].showBlurb=true;}
state.pros[opts.spID].pricingType=resp.type=='blurb'?'default':resp.type;injectOverlayData('pro',state.pros[opts.spID]);if(resp.type!='blurb')injectOverlayData(resp.type,resp.data);w.setTimeout(function(){$('.panel.'+state.pros[opts.spID].pricingType).addClass('loaded');},0);registerInfoTransfer('pricing',true);});};var handleConfirmationError=function(err,spID){var errStatus=(typeof err.statusId!='undefined')?err.statusId:0;var name="Instant Booking: Processing Overlay - FAILURE";if(typeof err.message!='undefined'&&err.message!='Unknown'){name+=" - "+err.message;}
s_sm.trackOverlayPage({},{name:pageNamePrefix+name});$('#confirmAppt').removeClass('loading');$('#confirmAppt').find('.text').text('Confirm Appointment');if(jsonModel.ibTest){state.dom.schedulingOverlay.style.display='none';state.dom.confirmationOverlay.style.display='block';}
if(errStatus==409){delete state.schedules[spID];state.currPro=false;var bookingBtn=$('a.ib[sp-id="'+spID+'"]')[0];$(bookingBtn).addClass('schedule-conflict');$('a.ib[sp-id="'+spID+'"]')[0].click();$(bookingBtn).removeClass('schedule-conflict');}else{$('#confirmError').addClass('visible');$(state.dom.confirmError).find('.text').text("There was a problem creating your appointment. We will have the pro call you to discuss your project.");if(typeof jsonCtrl().model['isMMR']=='undefined'||jsonCtrl().model['isMMR']=='false'){w.setTimeout(util.redirectToConfirmation,5000);}}};var confirmAppt=function(){if(!$(this).hasClass('loading')&&!$(this).hasClass('confirmed')){if(jsonModel.ibTest){state.dom.schedulingOverlay.style.display='block';state.dom.confirmationOverlay.style.display='none';}
if(typeof w['timeoutHandler']!='undefined')timeoutHandler.registerConfirmProcessStart();$(this).addClass('loading');$('#confirmError').removeClass('visible');$(this).find('.text').text('Confirming Appointment');bookAppt();}
return false;};var getPricingID=function(spID){var pricingID=false;if(typeof state.activities[spID]!='undefined'){if(typeof state.activities[spID]['pricing']!='undefined'){if(state.activities[spID]['pricing']){if(typeof state.activities[spID].pricing['pricingId']!='undefined'){pricingID=state.activities[spID].pricing.pricingId;}}}}
return pricingID;};var bookAppt=function(){var pricingID=getPricingID(state.currPro);var data={srOid:srOID,activityTypeId:state.pros[state.currPro].activityType,appointment:{startTime:state.appointment.start,endTime:state.appointment.end,smsRequested:false,callRequested:true,appointmentType:(state.pros[state.currPro].activityTypeString=='BOOKED_SERVICE')?"Service":"Estimate"}};var apptTypeOverride=$("input[name='workType']:checked").val();var addlEvars=[{eVarName:'eVar98',value:String(state.pros[state.currPro].responseRate)}];if(typeof apptTypeOverride!='undefined'){data.appointment.appointmentType=apptTypeOverride;if(apptTypeOverride=="Service"){data.activityTypeId=1;s_sm.fireSimpleEvent("event160","IB Perform the work selected",addlEvars);}else{data.activityTypeId=2;s_sm.fireSimpleEvent("event161","IB Provide estimate selected",addlEvars);}}
if(pricingID)data.appointment.pricingId=pricingID;services.scheduleAppt(state.currPro,srOID,data,function(err,resp){if(typeof w['timeoutHandler']!='undefined')timeoutHandler.registerConfirmProcessEnd();if(err){errorReporter.registerError('Lead API - Appt',err);handleConfirmationError(err,state.currPro);}else{$('#confirmAppt').addClass('confirmed').removeClass('loading');s_sm.ibScheduleAppointment();state.appointment.appointmentID=resp.appointmentOID;s_sm.trackOverlayPage({},{name:pageNamePrefix+"Instant Booking: Processing Overlay"});$('#confirmAppt .text').text('Appointment Confirmed');if(jsonModel.ibTest){injectOverlayData('chosenAppt',state.appointment);state.dom.schedulingOverlay.style.display='none';state.dom.scheduledOverlay.style.display='block';$('#confirmAppt').removeClass('confirmed')}
w.setTimeout(function(){util.registerAppointmentEvent(state.appointment);if(!jsonModel.ibTest){d.location.hash='';w.setTimeout(function(){$('#confirmAppt').removeClass('confirmed').find('.text').text('Confirm Appointment');},900);}},settings.successfulRedirectTimeout);}});};var injectOverlayData=function(objName,obj){simpleBind.bind(objName,obj);};pub.registerAuth=function(obj){state.auth=obj;saveState();};pub.angularIsReady=function(){};pub.registerProData=function(pros){for(var i=0;i<pros.length;++i){state.pros[pros[i].spId]=pros[i];}
state.ready=true;saveState();w.setTimeout(function(){for(var i=0;i<readySubscribers.length;++i){readySubscribers[i]();}},0);};pub.registerSrInfo=function(sr){state.srInfo=sr;saveState();};pub.onReady=function(func){if(typeof func!='undefined'&&typeof func=='function'){readySubscribers.push(func);}};pub.getSRInfo=function(){return state.srInfo;};pub.bookOnlineClickHandler=bookOnlineClickHandler;$(d).ready(init);return pub;})(window,document,jQuery,{});(function(w,d,$,sb){sb.registerEvent('miniProfile',function(evt,pro){s_sm.trackOverlayPage({},{name:"IB: Mini SP Profile Overlay"});if(typeof pro.reviews!='undefined'&&pro.reviews.length>5){pro.additionalReviews=pro.reviews.slice(5,10);pro.reviews=pro.reviews.slice(0,5);}
sb.bind('pro',pro);});sb.registerBindHandler('formatDate',function(el,d){var date=new Date(d.split(".")[0]);el.innerHTML=(date.getMonth()+1)+'/'+date.getDate()+'/'+date.getFullYear();});sb.registerBindHandler('trimRating',function(el,rating){el.innerHTML=Math.round(100*rating)/100;});sb.registerBindHandler('scoreToPercent',function(el,score){el.innerHTML=100*score;});sb.registerBindHandler('credentialItem',function(el,item){el.innerHTML=item;});})(window,document,jQuery,simpleBind);(function(w,d,$,sb){sb.registerEvent('contact',function(evt,pro){sb.bind('pro',pro);s_sm.trackOverlayPage({},{name:"IB: Contact Overlay"});});sb.registerFilter('formatPhoneNumber',function(val){return val.replace(/(\d{3})(\d{3})(\d{4})/,'($1) $2-$3');});sb.registerBindHandler('favProsHeart',function(el,pro){$(el).children(".fav-pros-heart").data('spId',pro.spId);})})(window,document,jQuery,simpleBind);(function(w,d,sb){sb.registerEvent('confirmationOverlay',function(){if(jsonCtrl().model.ibTest){$('#scheduledSection').hide();$('#confirmationSection').show();}});})(window,document,simpleBind);var bindHandlers=(function(w,d,$){var settings={buttonText:{results:{estimate:'Schedule Estimate',service:'View Pricing'},standalone:{estimate:'Schedule In-Person Quote',service:'See Pricing & Book Service'}}};var handlerKeys=['showWhenRatingExists','allowAdditionals','resultsHeading','resultsHeadingTest','hideIfBookedHandler','showWhenRatingDoesntExist','instantBookingBtnHandler','showBookingUnavailableButton','getQuoteBtnHandler','ratingHandler','profileLinkHandler','messagingLinkHandler','ratingLinkHandler','isPluralHandler','readMorePricingHandler','readMorePricingHandler','showIfMultiplePros','showAppropriatePricingPanel','proToolsHandler','addToCalendar','showFeaturedQuote','phoneLinkBindHandler','ibNotifications','injectSpid','showPhotoUrl','showOnlyWhen','ifPhotoExists','mobilePhoneTransformer','addClassWhenNoneAvailable','responseRateGauge','showWhenSelectedPros','hideWhenSelectedPros','showWhenSelected','hideWhenSelected','showWhenAppointment','hideWhenAppointment','calendarLinkHandler'];var filterKeys=['addCommas','initialOnly'];var setResponseRateGaugeValue=function(el,responseRate){var rotateStr=Math.round(responseRate/100*180);var needle=$(el).find('.needle').toArray();if(needle.length){needle=needle.shift();$(needle).animate({transformProp:rotateStr},{step:function(now){this.setAttribute('transform','rotate('+now+',44,42)');},duration:'2500',easing:'easeInQuad'});}
var semicircle=$(el).find('.gauge-color').toArray();if(semicircle.length){semicircle=semicircle.shift();var dashOffset=Math.max(0,Math.round(120-(responseRate/100*120)));semicircle.style.strokeDashoffset=dashOffset+'px';}};var filters={addCommas:function(val){if(isNaN(val))return val;;var newVal=val.toString().replace(/[^0-9\.]+/g,'').split('.');if(newVal[0].length<4)return newVal.join('.');var numCommas=Math.floor(newVal[0].length/3);numCommas-=(newVal[0].length%3)?0:1;for(var i=0;i<numCommas;++i){var start=newVal[0].length-(((i+1)*3)+i);newVal[0]=newVal[0].slice(0,start)+','+newVal[0].slice(start,newVal[0].length);}
return newVal.join('.');},initialOnly:function(val){if(val.length){val=val.substring(0,1)+'.';}
return val;}};var handlers={showFeaturedQuote:function(el,featuredQuote){if(typeof featuredQuote['truncatedQuote']=='undefined'){el.style.display='none';}else{el.style.display='';}},showWhenRatingExists:function(el,compositeRating){if(compositeRating!=0){el.style.display='';}else{el.style.display='none';}},allowAdditionals:function(el,appointments){var count=(typeof window['initialResults']!='undefined')?initialResults.getMatchCount():false;el.style.display=(count<=appointments.length)?'none':'';},resultsHeading:function(el,matches){var found=false,type=el.getAttribute("data-type");for(var i=0;i<matches.length;++i){if(typeof matches[i].booked!='undefined'){found=true;break;}}
if((found&&type=='subsequent')||(!found&&type=='initial')){el.style.display='';}else{el.style.display='none';}},resultsHeadingTest:function(el,matches){for(var i=0;i<matches.length;i++){if(typeof matches[i].appt!='undefined'||matches[i].leadId>0){el.style.display='none';break;}}},hideIfBookedHandler:function(el,ibPro){if(typeof ibPro['booked']!='undefined'){el.style.display='none';}else{el.style.display='';}},showWhenRatingDoesntExist:function(el,compositeRating){if(compositeRating==0){el.style.display='';}else{el.style.display='none';}},instantBookingBtnHandler:function(el,ibPro){var estimate,event,opts=$(el).data();estimate=(ibPro.activityTypeString!='BOOKED_SERVICE');var active=(ibPro.schedulable==true&&ibPro.spInfo.acceptType==2);event=(estimate)?'Schedule In-Person Quote':'View Pricing';event+=(ibPro.ibAccountInfo.accountType=='INTEGRATED')?'':' - dynamic';if(!active){el.style.display='none';}else{el.style.display='';el.setAttribute('sp-id',ibPro.spId);el.setAttribute('task-id',ibPro.taskOID);el.setAttribute('lead-type-id',ibPro.leadTypeId);el.setAttribute('sr-oid',ibPro.srOid);el.setAttribute('lead-id',ibPro.leadId);el.setAttribute('data-event',event);if(typeof opts['standalone']!='undefined'){el.innerHTML=(estimate)?settings.buttonText.standalone.estimate:settings.buttonText.standalone.service;}}},showBookingUnavailableButton:function(el,ibPro){var active=(ibPro.schedulable==true&&ibPro.spInfo.acceptType==2);el.style.display=active?'none':'';},getQuoteBtnHandler:function(el,ibPro){var requested=el.getAttribute('data-requested');var show=true;if(ibPro.hunger>0||ibPro.xmDirectoryPhoneNum){if(requested=='false'){el.setAttribute('data-spid',ibPro.spId);el.setAttribute('data-integrated',(ibPro.ibAccountInfo.accountType=='INTEGRATED'))}
if(ibPro.leadId==0){if(requested=='true')show=false;}else{if(requested=='false'){$(el).addClass('clicked');show=false;}}}else{show=false;}
el.style.display=(show)?'':'none';},ratingHandler:function(el,compositeRating){el.style.width=(parseFloat(compositeRating)/5)*100+'%';},profileLinkHandler:function(el,proData){el.setAttribute('href','/myhomeadvisor/myprojects/'+proData.srOid+'/profile/'+proData.spId+'/');},messagingLinkHandler:function(el,proData){var messagingEligible=jsonCtrl().model.messagingEligible;var messagingEligiblePros=jsonCtrl().model.messagingEligiblePros;if(!messagingEligible||!messagingEligiblePros||!messagingEligiblePros.hasOwnProperty(proData.spId)){el.style.display='none';}else{if(messagingEligiblePros[proData.spId])el.setAttribute('href','/channel/'+messagingEligiblePros[proData.spId]);else el.setAttribute('href','/channel?spId='+proData.spId);el.style.display='inline-block';if(!services.getState('messagingLinkShown')){s_sm.fireSimpleEvent('event278','Send a Message: Link Shown');services.saveState('messagingLinkShown',true);}}},ratingLinkHandler:function(el,proData){if(typeof proData['srOid']!='undefined'){el.setAttribute('href','/myhomeadvisor/myprojects/'+proData.srOid+'/profile/'+proData.spId+'/#ratings-reviews')}else if(typeof proData['ratedProfileLink']!='undefined'){el.setAttribute('href',proData.ratedProfileLink);}},isPluralHandler:function(el,number){number=parseInt(number);if(number>1)el.innerHTML="s";},readMorePricingHandler:function(el,pricingHTML,waitOver){if(typeof waitOver=='undefined'){w.setTimeout(function(){handlers.readMorePricingHandler(el,pricingHTML,true);},350);}else{var rel,section,opts;rel=el.getAttribute('data-rel');section=d.getElementById(rel);opts=$(section).data();section.style.maxHeight='';if(section.offsetHeight>opts.height){el.style.display='';}else{el.style.display='none';}
section.style.maxHeight=opts.height+'px';}},showIfMultiplePros:function(el,matches){var numQuoteable=services.getNumberEligibleForQuote(matches),numAppts=0,numQuotes=0,showRQFA=false;for(var i=0;i<matches.length;++i){if(typeof matches[i]['appt']!='undefined'){++numAppts;}else if(matches[i].leadId!=0){++numQuotes;}}
if(numQuoteable-numAppts-numQuotes>1){showRQFA=true;}
if(jsonCtrl().model.showImDoneUI&&!jsonCtrl().model.ibTest){if(showRQFA){el.removeAttribute('disabled');}else{el.setAttribute('disabled','true');}}else{el.style.display=showRQFA?'':'none';}},showAppropriatePricingPanel:function(el,proData){var pricingType=el.getAttribute('data-pricingtype');el.style.display=pricingType==proData.pricingType?'':'none';$(".ob-on-time-rating-container").addClass("loaded");},proToolsHandler:function(el,spID){el.setAttribute('data-spid',spID);},addToCalendar:function(el,data){var params={r_username:'myhawebapiuser',r_accesskey:'MjsEE6jv',summaryTemplate:encodeURIComponent('${task_desc} Appointment with ${sp_name}'),descriptionTemplate:encodeURIComponent('Appointment Information:\nService: ${task_desc_short}\n\${appointment_date}\n${homeowner_street} ${homeowner_city}, ${homeowner_state} ${homeowner_zip}\n\nPro Information:\n${sp_name}\nBusiness: ${sp_phone_business}\nCell: ${sp_phone_mobile}\n\nTo change or cancel your appointment please contact the other party directly.')};var qs='?'+$.param(params);if(data&&data.spID&&data.appointmentID){el.href='/api/resource/ib-ui/appointment/ics/'+data.appointmentID+'/homeadvisor-appointment.ics'+qs;}else if(data&&data.spId&&typeof data.appt=='object'){el.href='/api/resource/ib-ui/appointment/ics/'+data.appt.appointmentID+'/homeadvisor-appointment.ics'+qs;}},ibNotifications:function(el,data){if(typeof data.appointment!='undefined'){if(!$(el).hasClass('processed')){$(el).addClass('processed').removeClass('cancelled');el.style.display='';var apptType=data.activityTypeString=='IN_PERSON_ESTIMATE'?'In-Person Quote':'Service Appointment';if(data.appointment.currentState=='Cancelled'){var heading=apptType+' Appointment Cancelled';var label=timeUtils.formatDate(new Date(data.appointment.startTime),'#{l}, #{M} #{j}, #{Y} at #{h}:#{i} #{A}');$(el).addClass('cancelled');el.appendChild(jDom.create('p.heading${'+heading+'}$+p.body$>span${Your appointment for }$+span.label${'+label+'}$+span${ has been cancelled.}'));}else{var heading=apptType+' Scheduled';var label=timeUtils.formatDate(new Date(data.appointment.startTime),'#{l}, #{M} #{j}, #{Y} at #{h}:#{i} #{A}');el.appendChild(jDom.create('p.heading${'+heading+'}$+p.body$>span${Your pro will arrive on }$+span.label${'+label+'}'));}}}else{el.style.display='none';}},injectSpid:function(el,data){el.setAttribute('data-spid',data.spID||data.spId);el.setAttribute('data-company-name',data.companyName||data.spInfo.companyName);el.setAttribute('data-profile-url','/myhomeadvisor/myprojects/'+data.srOid+'/profile/'+data.spId);},showPhotoUrl:function(el,photoUrl){if(el&&photoUrl){el.src=photoUrl;}else{el.removeAttribute('src');}},showOnlyWhen:function(el,val){if(val){if(val.length==0){el.style.display='none';}else{}}else{el.style.display='none';}},ifPhotoExists:function(el,val){var $el=$(el);if(val){if(!$el.hasClass('instant-booking__with-photo')){$el.addClass('instant-booking__with-photo')}}else{if($el.hasClass('instant-booking__with-photo')){$el.removeClass('instant-booking__with-photo');}}},mobilePhoneTransformer:function(el,val){if(val){el.setAttribute('href','tel:'+val);}else{el.setAttribute('href','#');}
el.style.display='';},phoneLinkBindHandler:function(el,phoneNum){el.setAttribute('href','tel:'+phoneNum.replace(/[^0-9]/g,''));},addClassWhenNoneAvailable:function(el,matches){var found=false;for(var i=0;i<matches.length;++i){var active=(matches[i].schedulable==true&&matches[i].spInfo.acceptType==2);if(active){found=true;break;}}
if(found){$(el).removeClass('none-available');}else{$(el).addClass('none-available');}},responseRateGauge:function(el,pro){var responseRate=pro.responseRate;var ranges=[{low:0,high:33,class:'unhealthy'},{low:33,high:66,class:'warn'},{low:66,high:100,class:'healthy'}];var range=ranges[ranges.length-1];for(var i=0;i<ranges.length;++i){if(responseRate>=ranges[i].low&&responseRate<ranges[i].high){range=ranges[i];break;}}
setResponseRateGaugeValue(el,0);$(el).removeClass('unhealthy warn healthy').addClass(range.class);w.setTimeout(function(){setResponseRateGaugeValue(el,responseRate);},800);},showWhenSelectedPros:function(el,matches){for(var i=0;i<matches.length;i++){if(typeof matches[i].appt!='undefined'||matches[i].leadId!=0){el.style.display='block';}}},hideWhenSelectedPros:function(el,matches){var allSelected=true;for(var i=0;i<matches.length;i++){if(typeof matches[i].appt=='undefined'&&matches[i].leadId==0){allSelected=false;break;}}
if(allSelected)el.style.display='none';},showWhenSelected:function(el,match){if(typeof match.appt!='undefined'||match.leadId!=0){el.style.display='block';}},hideWhenSelected:function(el,match){if(typeof match.appt!='undefined'||match.leadId!=0){el.style.display='none';}},showWhenAppointment:function(el,match){el.style.display=(typeof match.appt!='undefined')?'block':'none';},hideWhenAppointment:function(el,match){if(typeof match.appt!='undefined')el.style.display='none';},calendarLinkHandler:function(el,appt){el.setAttribute('href','/instant-booking/ics/'+appt.appointmentID+'/HomeAdvisor.ics');}};for(var i=0;i<handlerKeys.length;++i){simpleBind.registerBindHandler(handlerKeys[i],handlers[handlerKeys[i]]);}
for(var i=0;i<filterKeys.length;++i){simpleBind.registerFilter(filterKeys[i],filters[filterKeys[i]]);}})(window,document,jQuery);(function(w,d,$,sb,api){sb.registerBindHandler('getQuoteBtnState',function(btn,pro){if(pro.leadId!=0){$(btn).removeClass('initial loading').addClass('loaded');}else{$(btn).addClass('initial').removeClass('loading loaded');}});sb.registerEvent('requestQuote',function(evt,pro){var btn=this;evt.preventDefault();if(!$(this).hasClass('initial'))return;$(this).removeClass('initial').addClass('loading');if(jsonCtrl().model.ibTest){window.scrollTo(0,0);}});})(window,document,jQuery,simpleBind,services);var initialResults=(function(w,d,$,pub){var init,complete,saveState,domCollection,getMatches,updateDisplayEngagement,wirePhoneQuoteButtons,requestQuotesFromAll,requestQuote;w['adHocSurveyExclude']=true;var state={dom:{},matches:[],quoteCount:0,quotableCount:0,srInfo:null};saveState=function(){var stateToSave=_.extend({},state);services.updateLocalStorage('ibMatches',{ibMatches:stateToSave.matches,serviceRequest:stateToSave.srInfo});delete stateToSave['dom'];delete stateToSave['matches'];delete stateToSave['srInfo'];services.saveState('initialResults',stateToSave)};var chain=function(){var functions=Array.prototype.slice.call(arguments);functions.forEach(function(fun,i,funs){funs[i]=function(){fun.apply(null,[funs[i+1]||function(){}].concat(Array.prototype.slice.call(arguments)));}});functions[0]();};init=function(){var savedState=services.getState('initialResults');if(savedState){state=_.extend(state,savedState);state.isReload=true;}
domCollection();chain(getMatches,getSite34068Result,getMessagingEligibility,complete);bookingOverlay.registerAuth({'r_username':'ob_cons_web_api','r_accesskey':accessKey});$(d).on('click','.request-quote',requestQuote);$('.request-from-all').on('click',requestQuotesFromAll);if(state.dom.imDoneBtn){$(state.dom.imDoneBtn).on('click',imDoneClickHandler);s_sm.fireSimpleEvent('event186','"I\'m Done" Button Presented');}};var addInformationToSrInfo=function(){state.srInfo.multiplePros=state.matches.length>1;state.srInfo.bookablePros=services.getNumberEligibleForBooking()>0;state.srInfo.quotablePros=false;for(var i=0;i<state.matches.length;++i){if(state.matches[i].hunger>0||state.matches[i].xmDirectoryPhoneNum){state.srInfo.quotablePros=true;}}};var getMessagingEligibility=function(next,matches){var spIds=matches.map(function(match){return match.spId;});jsonCtrl().model.messagingEligible=false;jsonCtrl().model.messagingEligiblePros={};services.getMessaging(spIds,function(err,resp){if(err)return;var messagingEligible=spIds.reduce(function(acc,spId){if(!resp.eligibilityMap[spId])return false;return resp.eligibilityMap[spId].eligible||acc;},false);var messagingEligiblePros={};if(messagingEligible){spIds.forEach(function(spId){if(resp.eligibilityMap[spId]){var eligiblePro=resp.eligibilityMap[spId];if(eligiblePro.eligible){var channel=eligiblePro.channel&&eligiblePro.channel.sid?eligiblePro.channel.sid:'';messagingEligiblePros[spId]=channel;}}});}
jsonCtrl().model.messagingEligible=messagingEligible;jsonCtrl().model.messagingEligiblePros=messagingEligiblePros;});next();};var getSite34068Result=function(next,matches){var isSite34068=true;for(var i=0;i<matches.length;i++){if(matches[i].matchTypeId==25&&(matches[i].hunger<=0||!matches[i].schedulable))isSite34068=false;if((matches[i].matchTypeId==9||matches[i].matchTypeId==10)&&!matches[i].schedulable)isSite34068=false;}
if(isSite34068){services.getSite34068Result(function(err,resp){initialResults.emit('site34068',resp);})}
next(matches);};complete=function(){addInformationToSrInfo();simpleBind.bind('sr',state.srInfo);simpleBind.bind('matches',state.matches);bookingOverlay.registerProData(state.matches);bookingOverlay.registerSrInfo(state.srInfo);postConfirmation.resultsLoaded();state.dom.loadingPanel.style.display='none';$("#resultsPage").addClass('loaded');if(typeof state['isReload']=='undefined'){saveState();updateDisplayEngagement();services.analyzeMatchesForOmniture(state.matches);}
if(state.dom.imDoneBtn){if(timeoutHandler.hasActionBeenTaken()){$(state.dom.imDoneBtn).addClass('enabled');if(services.getState('imDoneSelected')){state.dom.bookAddlContainer.style.display='none';}}}};domCollection=function(){state.dom={};state.dom.prosContainer=d.getElementById('ib-pros-container');state.dom.cloneable=state.dom.prosContainer.getElementsByTagName('div')[0];state.dom.resultsPanel=d.getElementById('resultsDiv');state.dom.loadingPanel=d.getElementById('initialLoadingPanel');state.dom.alertContainer=d.getElementById('harpAlertContainer');state.dom.imDoneBtn=d.getElementById('imDoneBtn');state.dom.bookAddlContainer=d.getElementById('bookAddlContainer');};getMatches=function(next){var verifyMatchIntegrity=function(data){for(var i=0;i<data.ibMatches.length;++i){if(typeof data.ibMatches[i]['ibAccountInfo']=='undefined'){errorReporter.registerError('Results API - Malformed',data);util.redirectToConfirmation();}}};services.getMatches(srOID,function(err,data){if(err){errorReporter.registerError('Results API',err);util.redirectToConfirmation();}else{verifyMatchIntegrity(data);state.srInfo=data.serviceRequest;state.srInfo.taskXmName=taskXmName;state.matches=data.ibMatches;next(data.ibMatches);}});};updateDisplayEngagement=function(){for(var i=0;i<state.matches.length;++i){if(state.matches[i].engagementType==2){state.matches[i].engagementType=1;services.setEngagement(state.matches[i].spId,srOID,{engagementStatusId:1},function(err,resp){if(err){errorReporter.registerError('Engagement API Error - Initial',err,{});}});}}};var fireSimpleEventTemp=function(eNum,eName,additionalEvars,additionalProps){additionalEvars=typeof additionalEvars=='undefined'?[]:additionalEvars;additionalProps=typeof additionalProps=='undefined'?{}:additionalProps;s_sm.linkTrackVars=(s_sm.linkTrackVars&&s_sm.linkTrackVars.length?s_sm.linkTrackVars+',events':'events');s_sm.linkTrackEvents=s_sm.events=eNum;for(var i=0;i<additionalEvars.length;++i){s_sm.linkTrackVars+=','+additionalEvars[i].eVarName;s_sm[additionalEvars[i].eVarName]=additionalEvars[i].value;}
for(var key in additionalProps){if(additionalProps.hasOwnProperty(key)){s_sm.linkTrackVars=s_sm.linkTrackVars.split(',');s_sm.linkTrackVars.push(key);s_sm.linkTrackVars=s_sm.linkTrackVars.join(',');s_sm[key]=additionalProps[key];}}
trackLinkWrapper(true,"o",eName);s_sm.linkTrackVars=s_sm.events='';};var imDoneClickHandler=function(){if($(this).hasClass('enabled')){goToConfirmationPage();pub.setImDone();var overallState=services.getState(),props={prop75:[overallState.initialResults.quoteCount,overallState.confirmation.appointments.length].join(',')};fireSimpleEventTemp('event187','"I\'m Done" Button Clicked',[],props);}
return false;};requestQuotesFromAll=function(){var disabledAttr=this.getAttribute('disabled');if(disabledAttr==null){s_sm.ibRequestAllPhoneQuote();var btns=$('a.request-quote:visible').addClass('from-all').click();if(jsonCtrl().model.ibTest){window.scrollTo(0,0);}}};requestQuote=function(){var btn=$(this)
if(!$(this).hasClass('clicked')&&!$(this).hasClass('loaded')){$(this).addClass('clicked');var opts=HA.dom(this).data();if(!$(this).hasClass('from-all')){s_sm.ibRequestSinglePhoneQuote();}
if(state.dom.imDoneBtn){$(state.dom.imDoneBtn).addClass('enabled');}
services.updateLeadIdBySpId(opts.spid,1);services.requestPhoneQuote(opts.spid,srOID,opts.integrated,function(err,resp){if(err&&!jsonCtrl().model.showImDoneUI){errorReporter.registerError('Lead API - Phone',err);services.updateLeadIdBySpId(opts.spid,0);}else{if(err){errorReporter.registerError('Lead API - Phone',err);}
++state.quoteCount;saveState();var numEligible=services.getNumberEligibleForQuote(state.matches);var visibleQuoteButtons=$('a.request-quote:not(.loaded)').filter(':visible').toArray().length>0;var requestFromAllHappened=!visibleQuoteButtons&&postConfirmation.state.appointments.length==0;var allApptsBooked=services.getNumberEligibleForBooking()==0||services.getNumberEligibleForBooking()<=postConfirmation.state.appointments.length;if(jsonCtrl().model.ibTest){btn.addClass('loaded').removeClass('loading').removeClass('clicked');return;}
if(!visibleQuoteButtons&&allApptsBooked){util.logAutoForward();pub.setImDone();goToConfirmationPage();}}});}};var goToConfirmationPage=function(){state.quotableCount=$('a.request-quote:not(.loaded)').filter(':visible').toArray().length;saveState();postConfirmation.changePage('confirmationPage');};$(d).ready(init);pub.registerAppointments=function(appointments){var updatedMatches=false;for(var i=0;i<appointments.length;++i){for(var j=0;j<state.matches.length;++j){if(state.matches[j].spId==appointments[i].spID){if(typeof state.matches[j].booked=='undefined'){state.matches[j].booked=true;state.matches[j].appt=appointments[i];updatedMatches=true;}
break;}}}
if(state.dom.imDoneBtn){$(state.dom.imDoneBtn).addClass('enabled');}
if(updatedMatches){saveState();simpleBind.bind('matches',state.matches);}};simpleBind.registerEvent('goToConfirmationPage',goToConfirmationPage);simpleBind.registerEvent('doneButtonHandler',function(evt){evt.preventDefault();modal.closeSynthetic();});pub.getMatchCount=function(){return state.matches.length;};pub.setImDone=function(){state.dom.bookAddlContainer.style.display='none';services.saveState('imDoneSelected',true)};return pub;})(window,document,jQuery,new EmitterFactory(initialResults));var postConfirmation=(function(w,d,$,pub){var init,saveState;var state,dom,domCollection,showPage,hideCurrent,bookAdditionalClickHandler,currPage=null,timer=null,loadedHash=false,domLoaded=false,omnitureLoaded=false;state=services.getState('confirmation');var isMMR=typeof w['isMMRARTest']!='undefined';customLinkModule.setPageName('IB Appointment Details:');init=function(){domCollection();simpleBind.bind('appointments',state.appointments);$(dom.confirmationPage).addClass('loaded');state.cache=(jsonCtrl().model.cached?$.extend({},jsonCtrl().model.cached):{});var imDoneSelected=services.getState('imDoneSelected');if(state.appointments.length||imDoneSelected){var showConfirmationPage=(imDoneSelected||(services.getNumberEligibleForBooking()>0&&services.getNumberEligibleForBooking()==state.appointments.length))&&!jsonCtrl().model.ibTest;showPage(showConfirmationPage?'confirmationPage':'resultsPage');$('#header').addClass('full');initialResults.registerAppointments(state.appointments);}else{if(!state.initialLoad){showPage('resultsPage');}}
$('.book-additional').on('click',bookAdditionalClickHandler);modal.onHashChange(sanitizeHashChanges);domLoaded=true;if(loadedHash)popOverlay();};var sanitizeHashChanges=function(hash){if(currPage=='confirmationPage'&&(hash=='#confirmation'||hash=='#appointment')){modal.close();}};var getCache=function(name){if(typeof state.cache=='object'){if(typeof state.cache[name]!='undefined')return state.cache[name];}
return null;};var setCache=function(key,val){services.putCoherenceCache({name:jsonCtrl().model.pageName,key:key,val:(typeof val!='undefined'?val:true)},function(err,resp){});};var displayHarpModalOnLoad=function(){if(dom.alertContainer){if(!getCache('hasImmediatelyShownHarpInvite')&&jsonCtrl().model.isNewUser&&dom.alertContainer.getAttribute('data-is-enrolling-sroid')=='true'){setCache('hasImmediatelyShownHarpInvite',true);modal.open('harp');}}};var stateChangeHandler=function(pageName){var name=(pageName=='resultsPage')?'IB: Matches':'IB Appointment Details';if(typeof w['isMMRARTest']!='undefined'){name=isMMRARTest?'MMR-'+name:name;}
if(pageName=='confirmationPage'){simpleMapModule.externalInit();if(!omnitureLoaded){omnitureLoaded=true;costGuideSimple.externalInit();if(dom.floatingXSell&&typeof xhrXSell!='undefined'){xhrXSell.externalInit();$(dom.floatingXSell).removeClass('invisible').addClass('visible');customLinkModule.trackModule(dom.floatingXSell.getAttribute('data-omniture-module'));var currSrOid=jsonCtrl().model.srOid;try{if(w.localStorage.getItem('hideCrossSellModule_'+currSrOid)==null)w.setTimeout(xhrXSell.popFloaty,1000);$('[data-closefloatyxsell]').on('click',function(){w.localStorage.setItem('hideCrossSellModule_'+currSrOid,'true');});}catch(err){console.log(err);}}
displayHarpModalOnLoad();if(dom.xhrTrueCostGuide){customLinkModule.trackModule(dom.xhrTrueCostGuide.getAttribute('data-omniture-module'));}
customLinkModule.collectModules();}}else{$(dom.floatingXSell).removeClass('visible').addClass('invisible');}
s_sm.trackOverlayPage({},{name:name});$.get("/servlet/SessionLogServlet?pageName="+name);if(typeof w.floatyBar!='undefined'){w.setTimeout(floatyBar.recalculateThresholds,1000);}};saveState=function(){services.updateLocalStorage('confirmation',state);};domCollection=function(){dom={confirmationPage:d.getElementById('confirmedPage'),resultsPage:d.getElementById('resultsPage'),floatingXSell:d.getElementById('floatingXSell'),xhrTrueCostGuide:d.getElementById('xhr-true-cost-widget'),alertContainer:d.getElementById('harpAlertContainer')};};var updateBookAddlState=function(page){if(page=='confirmationPage'){var overallState=services.getState(),apptDetailsState={addlBookable:true,addlQuotable:true},numBookable=services.getNumberEligibleForBooking();if(numBookable==0||numBookable<=overallState.confirmation.appointments.length){apptDetailsState.addlBookable=false;}
if(services.getState().initialResults.quotableCount==0){apptDetailsState.addlQuotable=false;}
simpleBind.bind('apptDetailsState',apptDetailsState);}};showPage=function(page,waitOver){timer=w.clearTimeout(timer);waitOver=(typeof waitOver=='undefined')?false:waitOver;if(!waitOver){if(currPage)hideCurrent();updateBookAddlState(page);currPage=page;$(dom[page]).css({display:''});timer=w.setTimeout(function(){showPage(page,true);},50);favProsHeart.externalInit();}else{if(page=='confirmationPage')$('#header').addClass('full');services.buildSelectedPros(page);$(dom[page]).addClass('visible');stateChangeHandler(page);}};hideCurrent=function(){$(dom[currPage]).css({display:'none'}).removeClass('visible');};bookAdditionalClickHandler=function(){showPage('resultsPage');};var determineNextPage=function(){var imDoneSelected=services.getState('imDoneSelected');var allApptsBooked=services.getNumberEligibleForBooking()>0&&services.getNumberEligibleForBooking()<=state.appointments.length;var allQuotesRequested=$('.btn.loadable.request-quote:not(.loaded)').filter(':visible').toArray().length==0;var goToConfirmationPage=allApptsBooked&&allQuotesRequested;if(jsonCtrl().model.showImDoneUI){goToConfirmationPage=imDoneSelected||(allQuotesRequested&&allApptsBooked);if(goToConfirmationPage&&!imDoneSelected)util.logAutoForward();if(goToConfirmationPage)initialResults.setImDone();}else if(allQuotesRequested&&allApptsBooked){goToConfirmationPage=true;if(goToConfirmationPage)util.logAutoForward();}
return goToConfirmationPage?'confirmationPage':'resultsPage';};pub.registerAppointment=function(appointment){state.appointments.splice(0,0,appointment);simpleBind.bind('appointments',state.appointments);if(appointment.type!='estimate'){state.serviceBooked=true;}
saveState();initialResults.registerAppointments(state.appointments);if(!jsonCtrl().model.ibTest)showPage(determineNextPage());};pub.changePage=function(page){showPage(page);return false;};pub.resultsLoaded=function(){if(state.initialLoad){state.initialLoad=false;if(domLoaded){showPage(determineNextPage());}}};pub.state=state;if(w.location.hash!=''){loadedHash=w.location.hash.substring(1);if(loadedHash.indexOf('=')>-1){loadedHash=loadedHash.split('=');if(loadedHash[0]=='spId'&&loadedHash.length==2){loadedHash=loadedHash[1];bookingOverlay.onReady(function(){if(domLoaded&&loadedHash){popOverlay();}});}else{loadedHash=false;}}else{loadedHash=false;}
w.location.hash='';}
var popOverlay=function(){if(currPage!='resultsPage')showPage('resultsPage');var bookingBtn=$('[sp-id="'+loadedHash+'"]').toArray();if(bookingBtn.length){bookingBtn=bookingBtn.shift();bookingBtn.click();w.location.hash='#appointment';loadedHash=false;}};$(d).ready(init);return pub;})(window,document,jQuery,{});var timeoutHandler=(function(w,d,$,pub){var init,checkTimeout,checkInteractionMarkers;var confirmingNow=false;var state=services.getState('timeoutHandler'),settings={timeout:15,interval:60000};services.saveState('timeoutHandler',state);init=function(){settings.timeout=jsonCtrl().model.timeoutMinutes;checkTimeout();};checkTimeout=function(){var now=new Date().getTime();if(now-state.initiated>settings.timeout*60000){var interaction=checkInteractionMarkers();if(!interaction){util.logTimeout();util.redirectToConfirmation(false,'26');}else{}}else{w.setTimeout(checkTimeout,settings.interval);}};checkInteractionMarkers=function(){var cache=store.get('ib.'+srOID),interaction=false;if(cache.ibMatches){for(var i=0;i<cache.ibMatches.ibMatches.length;++i){if(cache.ibMatches.ibMatches[i].leadId!=0||typeof cache.ibMatches.ibMatches[i]['booked']!='undefined'||typeof cache.ibMatches.ibMatches[i]['quoteRequested']!='undefined'){interaction=true;break;}}}
return(interaction||confirmingNow);};pub.registerConfirmProcessStart=function(){confirmingNow=true;};pub.registerConfirmProcessEnd=function(){confirmingNow=false;};pub.hasActionBeenTaken=function(){return checkInteractionMarkers();};$(d).ready(init);return pub;})(window,document,jQuery,{});$(document).on('click','a[data-event]',function(){if(!this.getAttribute('disabled')){var event=$(this).data("event");}});var stickyFooter=(function(w,d,$,sb){var state={footer:'',}
var decide=function(){var $stop=$('#floatyAnchor');if(window.innerHeight+window.pageYOffset<$stop.offset().top){$(state.footer).addClass('visible')}else{$(state.footer).removeClass('visible')}}
var init=function(){window.addEventListener('scroll',decide);decide()}
sb.registerBindHandler('stickyFooter',function(el,matches){state.footer=el;init();})
return state;})(window,document,jQuery,simpleBind);